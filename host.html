<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º ‚Äî –ö–æ–º–∞–Ω–¥–Ω—ã–π –∫–≤–µ—Å—Ç (Host)</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0e0e11; --panel:#181a20; --muted:#b7bac4; --accent:#ffb703;
    --ghost:#7dd3fc; --hunters:#fca5a5; --ok:#9dffb2; --bad:#ffb4b4; --line:#2b2f39;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; color:#fff; background:var(--bg); font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
  header{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:16px; position:sticky; top:0; background:#0e0e11e6; backdrop-filter:saturate(130%) blur(6px); z-index:10;
    border-bottom:1px solid #2a2d36;
  }
  h1{margin:0; font-size:clamp(18px,3.4vw,32px); line-height:1.1}
  .btn{border:none; border-radius:12px; padding:10px 14px; font-weight:900; cursor:pointer}
  .btn.primary{background:var(--accent); color:#000}
  .btn.secondary{background:#252a34; color:#fff}
  .teamTag{display:none; border:1px solid #ffffff1a; border-radius:999px; padding:8px 12px; font-weight:800}
  .teamTag.ghost{display:inline-block; background:color-mix(in oklab, var(--ghost) 20%, #000 80%); color:#e9f9ff}
  .teamTag.hunters{display:inline-block; background:color-mix(in oklab, var(--hunters) 20%, #000 80%); color:#fff2f2}
  .wrap{max-width:980px; margin:20px auto; padding:0 16px}
  .card{
    background:linear-gradient(180deg,#1a1d24 0%,#12151a 100%);
    border:1px solid var(--line); border-radius:18px; overflow:hidden;
    box-shadow:0 20px 80px #0008;
  }
  .roomHero{aspect-ratio:16/9; width:100%; background:#0d0f14 center/cover no-repeat; border-bottom:1px solid var(--line)}
  .roomBody{padding:18px}
  .roomTitle{margin:0 0 8px; font-size:clamp(20px,3vw,28px)}
  .story{color:#e6e7ec; margin:0 0 8px}
  .muted{color:var(--muted)}
  .inputRow{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap}
  input[type=text]{flex:1; min-width:220px; padding:12px 14px; border-radius:12px; border:1px solid #2f3340; background:#0f1116; color:#fff; outline:none}
  .notice{margin-top:8px; font-weight:700}
  .ok{color:var(--ok)} .fail{color:var(--bad)}
  .foot{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:14px}
  .nextBtn{display:none}
  .nextBtn.show{display:inline-block}
  .progress{margin:8px 0 0; color:#bfc3ce; font-size:14px}
  .teamChoice{
    display:grid; gap:12px; grid-template-columns:1fr; max-width:520px; margin:16px auto 0;
  }
  .teamChoice .opt{
    border:1px solid var(--line); border-radius:14px; padding:16px; cursor:pointer; font-weight:900; text-transform:uppercase; text-align:center;
  }
  .opt.ghost{background:color-mix(in oklab, var(--ghost) 15%, #0b0d12 85%); color:#e9f9ff}
  .opt.hunters{background:color-mix(in oklab, var(--hunters) 15%, #0b0d12 85%); color:#fff2f2}
  @media (min-width:640px){ .teamChoice{grid-template-columns:1fr 1fr;} }
</style>
</head>
<body>
<header>
  <h1>–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º ‚Äî –ö–æ–º–∞–Ω–¥–Ω—ã–π –∫–≤–µ—Å—Ç</h1>
  <div style="display:flex;gap:8px;align-items:center">
    <div id="teamTag" class="teamTag" aria-live="polite"></div>
    <button id="btnStart" class="btn primary" type="button">–°—Ç–∞—Ä—Ç</button>
    <button id="btnReset" class="btn secondary" type="button">–°–±—Ä–æ—Å</button>
  </div>
</header>

<div class="wrap">
  <!-- –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ -->
  <section id="intro" class="card">
    <div class="roomHero" style="background-image:url('door.png');"></div>
    <div class="roomBody">
      <p class="story">
        –≠—Ç–æ—Ç –¥–æ–º —Å—Ç–æ–∏—Ç –Ω–∞ —Ö–æ–ª–º–µ —É–∂–µ —Å–æ—Ç–Ω–∏ –ª–µ—Ç. –ù–∏–∫—Ç–æ –Ω–µ –ø–æ–º–Ω–∏—Ç, –∫—Ç–æ –∏ –∑–∞—á–µ–º –µ–≥–æ –ø–æ—Å—Ç—Ä–æ–∏–ª.
        –ù–æ –∫–∞–∂–¥—ã–π –•—ç–ª–ª–æ—É–∏–Ω –µ–≥–æ –æ–∫–Ω–∞ –∑–∞–≥–æ—Ä–∞—é—Ç—Å—è —Å—Ç—Ä–∞–Ω–Ω—ã–º —Å–≤–µ—Ç–æ–º, –∞ –¥–≤–µ—Ä–∏ –ø—Ä–∏–æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è ‚Äî –±—É–¥—Ç–æ –∑–æ–≤—É—Ç –≤–æ–π—Ç–∏.
        –¢–æ–ª—å–∫–æ —Å–∞–º—ã–µ —Å–º–µ–ª—ã–µ —Ä–µ—à–∞—é—Ç—Å—è –ø–µ—Ä–µ—Å—Ç—É–ø–∏—Ç—å –ø–æ—Ä–æ–≥.
        –î–æ–º —Å–∞–º —Ä–∞–∑–¥–µ–ª–∏—Ç –≤–∞—Å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã‚Ä¶ –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –∏–º–µ–Ω–Ω–æ –≤—ã –æ—Ç–∫—Ä–æ–µ—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–≤–µ—Ä—å.
      </p>
      <p class="muted">–ù–∞–∂–º–∏—Ç–µ ¬´–°—Ç–∞—Ä—Ç¬ª, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Å–≤–æ—é –∫–æ–º–∞–Ω–¥—É –∏ –≤–æ–π—Ç–∏ –≤ –¥–æ–º.</p>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –∫–æ–º–∞–Ω–¥—ã (–≤–º–µ—Å—Ç–æ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è) -->
  <section id="teamScreen" class="card" style="display:none">
    <div class="roomHero" style="background-image:url('mirrors.png')"></div>
    <div class="roomBody" style="text-align:center">
      <h2 class="roomTitle" style="margin-bottom:8px">–ö –∫–∞–∫–æ–π –∫–æ–º–∞–Ω–¥–µ –≤—ã –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç–µ?</h2>
      <p class="muted" style="margin-top:0">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É, –∫–æ—Ç–æ—Ä—É—é –æ–ø—Ä–µ–¥–µ–ª–∏–ª ¬´—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å¬ª –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ <b>teams.html</b>.</p>

      <div class="teamChoice">
        <button class="opt ghost"   id="chooseGhosts">üëª –Ø ‚Äî –ü–†–ò–ó–†–ê–ö</button>
        <button class="opt hunters" id="chooseHunters">üéØ –Ø ‚Äî –û–•–û–¢–ù–ò–ö</button>
      </div>

      <div id="chosenWrap" style="display:none; margin-top:14px">
        <div class="muted">–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞:</div>
        <div id="bigTeam" class="teamName" style="margin:6px 0 10px">‚Äî</div>
        <p class="muted">–ù–∞–π–¥–∏—Ç–µ –¥—Ä—É–≥–∏—Ö —á–ª–µ–Ω–æ–≤ –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã –∏ —Å–æ–±–µ—Ä–∏—Ç–µ—Å—å –≤–º–µ—Å—Ç–µ. –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã ‚Äî –Ω–∞—á–Ω–∏—Ç–µ.</p>
        <button id="readyBtn" class="btn primary" type="button">–ì–æ—Ç–æ–≤—ã</button>
      </div>
    </div>
  </section>

  <!-- –¢–µ–∫—É—â–∞—è –∫–æ–º–Ω–∞—Ç–∞ -->
  <section id="room" class="card" style="display:none" aria-live="polite">
    <div id="roomHero" class="roomHero"></div>
    <div class="roomBody">
      <h2 id="roomTitle" class="roomTitle"></h2>
      <p id="roomStory" class="story"></p>
      <div id="taskBox"></div>
      <div id="result" class="notice"></div>
      <div class="foot">
        <div id="progressText" class="progress">–ö–æ–º–Ω–∞—Ç–∞ 1 –∏–∑ 4</div>
        <button id="nextBtn" class="btn primary nextBtn" type="button">–î–∞–ª—å—à–µ</button>
      </div>
    </div>
  </section>

  <!-- –§–∏–Ω–∞–ª -->
  <section id="final" class="card" style="display:none">
    <div class="roomHero" style="background-image:url('door.png')"></div>
    <div class="roomBody">
      <h2 class="roomTitle">–î–≤–µ—Ä—å —Ä–∞—Å–ø–∞—Ö–Ω—É–ª–∞—Å—å!</h2>
      <p class="story">–î–æ–º –ø—Ä–∏–Ω—è–ª –≤–∞—à—É —Å–º–µ–ª–æ—Å—Ç—å –∏ —Å–º–µ–∫–∞–ª–∫—É. –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –∫–æ–º–∞–Ω–¥–∞!</p>
      <p id="finalTeam" class="muted"></p>
      <button id="playAgain" class="btn secondary" type="button">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
    </div>
  </section>
</div>

<script>
const TEAMS = [
  { id:'ghosts',  name:'–ü–†–ò–ó–†–ê–ö–ò', color:'ghost' },
  { id:'hunters', name:'–û–•–û–¢–ù–ò–ö–ò', color:'hunters' }
];

const ROOMS = [
  // 1) –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ‚Äî –°–Ω–∞—á–∞–ª–∞ —Å–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –∑–∞—Ç–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–æ –±—É–∫–≤—ã. –ü—Ä–µ–¥–º–µ—Ç—ã –ø–µ—Ä–µ–º–µ—à–∏–≤–∞—é—Ç—Å—è.
  {
    key:'library',
    title:'–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞',
    img:'library.png',
    story:'–ü–æ–ª–∫–∏ –¥–æ –ø–æ—Ç–æ–ª–∫–∞, –∫–∞—Ä—Ç–æ—á–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –∏ —Å–∫—Ä–∏–ø –ø–µ—Ä—å–µ–≤–æ–π —Ä—É—á–∫–∏. –ù–∞ —Å—Ç–æ–ª–µ –∑–∞–ø–∏—Å–∫–∞: ¬´–ö–ª—é—á ‚Äî –≤ –ø–µ—Ä–≤—ã—Ö –±—É–∫–≤–∞—Ö –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ¬ª.',
    render(container, helpers){
      const items = ['–ö—Ä—É–∂–∫–∞','–ù–æ—Å–æ–∫','–ò–≥—Ä—É—à–∫–∞','–ì—Ä–µ–±–µ–Ω—å','–ê–ª—å–±–æ–º']; // –ö –ù –ò –ì –ê
      // –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –¥–ª—è —á–µ—Å—Ç–Ω–æ—Å—Ç–∏
      const shuffled = items.slice().sort(()=>Math.random()-0.5);

      container.innerHTML = `
        <p><b>–ù–∞–π–¥–∏—Ç–µ –∏ —Å–æ–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π —ç—Ç–∏ 5 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ):</b></p>
        <ul id="itemList">${shuffled.map(it=>`<li>${it}</li>`).join('')}</ul>
        <button id="confirmItems" class="btn primary" style="margin-top:10px">–ü—Ä–µ–¥–º–µ—Ç—ã —Å–æ–±—Ä–∞–Ω—ã</button>

        <div id="stage2" style="display:none; margin-top:16px">
          <p class="muted">–ü–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –æ–±—Ä–∞–∑—É—é—Ç –ø–∞—Ä–æ–ª—å. –í–≤–µ–¥–∏—Ç–µ –µ–≥–æ –Ω–∏–∂–µ:</p>
          <div class="inputRow">
            <input id="libAnswer" type="text" placeholder="–≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="off">
            <button id="libCheck" class="btn secondary" type="button">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
          </div>
        </div>
      `;

      const confirmBtn = container.querySelector('#confirmItems');
      const stage2 = container.querySelector('#stage2');
      const inp = container.querySelector('#libAnswer');

      confirmBtn.onclick = ()=>{
        confirmBtn.disabled = true;
        confirmBtn.textContent = '–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —Ä–∞–∑–≥–∞–¥–∞–π—Ç–µ, —á—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —ç—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç—ã...';
        stage2.style.display = 'block';
      };

      const check = ()=>{
        const val = (inp.value||'').trim().toUpperCase();
        if (val === '–ö–ù–ò–ì–ê') helpers.check(true);
        else helpers.check(false);
      };

      container.querySelector('#libCheck').onclick = check;
      inp.addEventListener('keydown', e=>{ if(e.key==='Enter') check(); });
    }
  },

  // 2) –ê–ª—Ö–∏–º–∏–∫ ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–µ–¥—É—â–µ–π (—É–¥–µ—Ä–∂–∞–Ω–∏–µ 2 —Å–µ–∫)
  {
    key:'alchemy',
    title:'–ö–æ–º–Ω–∞—Ç–∞ 2. –ê–ª—Ö–∏–º–∏–∫ ‚Äî ¬´–ó–µ–ª—å–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è¬ª',
    img:'alchemy.png',
    story:'–°–∏—è—é—Ç –∫–æ–ª–±—ã, –ø–∞—Ö–Ω–µ—Ç —á–∞–µ–º –∏ —Å–ø–µ—Ü–∏—è–º–∏. –î–æ–º –∂–¥—ë—Ç, –∫–æ–≥–¥–∞ –≤—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç–µ –∑–µ–ª—å–µ –≤–º–µ—Å—Ç–µ.',
    render(container, helpers){
      container.innerHTML = `
        <p><b>–°–≤–∞—Ä–∏—Ç–µ –∑–µ–ª—å–µ ¬´–°–ø–æ–∫–æ–π—Å—Ç–≤–∏—è¬ª:</b></p>
        <ol>
          <li>–ö—Ä—É–∂–∫–∞ –≥–æ—Ä—è—á–µ–≥–æ <b>—á–∞—è</b>.</li>
          <li>–î–æ–±–∞–≤—å—Ç–µ <b>—è–≥–æ–¥—ã</b> –∏–ª–∏ –ª–æ–∂–∫—É –≤–∞—Ä–µ–Ω—å—è.</li>
          <li>–†–∞–∑–º–µ—à–∞–π—Ç–µ –ª–æ–∂–∫—É <b>–º—ë–¥–∞</b>.</li>
          <li>–©–µ–ø–æ—Ç–∫–∞ <b>–∫–æ—Ä–∏—Ü—ã</b> –∏–ª–∏ <b>–∏–º–±–∏—Ä—è</b>.</li>
          <li>–ú–æ–∂–Ω–æ –Ω–µ–º–Ω–æ–≥–æ <b>–º–æ–ª–æ–∫–∞</b>.</li>
        </ol>
        <p>–ö–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ –∏ –≤–µ–¥—É—â–∞—è –æ–¥–æ–±—Ä—è–µ—Ç ‚Äî –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É.</p>
        <button id="holdOk" class="btn primary">–í–µ–¥—É—â–∞—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç</button>`;
      const btn = container.querySelector('#holdOk');
      let t = null;
      btn.addEventListener('pointerdown', () => { t = setTimeout(() => helpers.check(true), 2000); });
      ['pointerup','pointerleave','pointercancel'].forEach(ev => btn.addEventListener(ev, () => clearTimeout(t)));
    }
  },

  // 3) –ó–∞–ª –∑–µ—Ä–∫–∞–ª ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–µ–¥—É—â–µ–π (—É–¥–µ—Ä–∂–∞–Ω–∏–µ 2 —Å–µ–∫)
  {
    key:'mirrors',
    title:'–ö–æ–º–Ω–∞—Ç–∞ 3. –ó–∞–ª –∑–µ—Ä–∫–∞–ª ‚Äî ¬´–≠—Å—Ç–∞—Ñ–µ—Ç–∞ –æ—Ç—Ä–∞–∂–µ–Ω–∏–π¬ª',
    img:'mirrors.png',
    story:'–û—Ç—Ä–∞–∂–µ–Ω–∏—è –º–Ω–æ–∂–∞—Ç—Å—è –∏ –∂–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã.',
    render(container, helpers){
      container.innerHTML = `
        <p><b>–ó–∞–¥–∞–Ω–∏–µ:</b> –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –∂–µ—Å—Ç. –°–ª–µ–¥—É—é—â–∏–π –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –¥–æ 5 –∂–µ—Å—Ç–æ–≤, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ü–µ–ø–æ—á–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.</p>
        <button id="holdOk2" class="btn primary">–í–µ–¥—É—â–∞—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç</button>`;
      const btn = container.querySelector('#holdOk2');
      let t = null;
      btn.addEventListener('pointerdown', ()=>{ t=setTimeout(()=>helpers.check(true),2000); });
      ['pointerup','pointerleave','pointercancel'].forEach(ev=> btn.addEventListener(ev, ()=>clearTimeout(t)));
    }
  },

  // 4) –§–∏–Ω–∞–ª—å–Ω–∞—è –¥–≤–µ—Ä—å ‚Äî —Ç—Ä–∏ –∑–∞–≥–∞–¥–∫–∏
  {
    key:'door',
    title:'–§–∏–Ω–∞–ª—å–Ω–∞—è –¥–≤–µ—Ä—å ‚Äî ¬´–¢—Ä–∏ –∑–∞–º–∫–∞¬ª',
    img:'door.png',
    story:'–ù–∞ –¥–≤–µ—Ä–∏ ‚Äî —Ç—Ä–∏ –∑–∞–º–∫–∞. –ö–∞–∂–¥—ã–π –∂–¥—ë—Ç —Å–≤–æ—ë —Å–ª–æ–≤–æ. –û–±—Å—É–¥–∏—Ç–µ –≤–º–µ—Å—Ç–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤—Å–µ.',
    render(container, helpers){
      container.innerHTML = `
        <p><b>–ó–∞–º–æ–∫ I:</b> ¬´–ë–µ–∑ –Ω–æ–≥ —Ö–æ–∂—É, –±–µ–∑ —è–∑—ã–∫–∞ –≥–æ–≤–æ—Ä—é, –∑–∞ —Å–æ–ª–Ω—Ü–µ–º –∏–¥—É, –Ω–æ—á—å—é —Å–ø–ª—é. –ö—Ç–æ —è?¬ª</p>
        <input id="z1" type="text" placeholder="(–∂.—Ä.)">
        <p><b>–ó–∞–º–æ–∫ II:</b> ¬´–ï—ë –Ω–µ –≤–∏–¥–Ω–æ, –Ω–æ –≤—Å–µ —á—É–≤—Å—Ç–≤—É—é—Ç. –û–Ω–∞ —Å–æ–≥—Ä–µ–≤–∞–µ—Ç –¥–æ–º –±–µ–∑ –æ–≥–Ω—è. –ß—Ç–æ —ç—Ç–æ?¬ª</p>
        <input id="z2" type="text" placeholder="(–∂.—Ä.)">
        <p><b>–ó–∞–º–æ–∫ III:</b> ¬´–û–Ω–∞ –∏–¥—ë—Ç –≤–ø–µ—Ä—ë–¥, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è. –ß—Ç–æ —ç—Ç–æ?¬ª</p>
        <input id="z3" type="text" placeholder="(—Å—Ä.—Ä.)">
        <button id="doorCheck" class="btn secondary" style="margin-top:10px">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <div id="doorRes" class="notice"></div>`;
      const n=s=>(s||'').trim().toLowerCase().replaceAll('—ë','–µ');
      container.querySelector('#doorCheck').onclick=()=>{
        const a1=n(document.getElementById('z1').value),
              a2=n(document.getElementById('z2').value),
              a3=n(document.getElementById('z3').value);
        if(a1==='—Ç–µ–Ω—å'&&a2==='–ª—é–±–æ–≤—å'&&a3==='–≤—Ä–µ–º—è') helpers.check(true);
        else document.getElementById('doorRes').textContent='–ù–µ –≤—Å–µ –∑–∞–º–∫–∏ –æ—Ç–∫—Ä—ã–ª–∏—Å—å. –û–±—Å—É–¥–∏—Ç–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!';
      };
    }
  }
];

// ===== —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
const $=s=>document.querySelector(s);
const el={
  teamTag:$('#teamTag'),btnStart:$('#btnStart'),btnReset:$('#btnReset'),
  teamScreen:$('#teamScreen'),room:$('#room'),hero:$('#roomHero'),
  title:$('#roomTitle'),story:$('#roomStory'),task:$('#taskBox'),
  result:$('#result'),next:$('#nextBtn'),progress:$('#progressText'),
  final:$('#final'),finalTeam:$('#finalTeam'),playAgain:$('#playAgain')
};
let team=null,idx=0;

// ===== –≤—ã–±–æ—Ä –∫–æ–º–∞–Ω–¥—ã (–Ω–µ —Ä–∞–Ω–¥–æ–º)
function applyTeam(t){
  team=t; try{ localStorage.setItem('hn_team',JSON.stringify(t)); }catch(e){}
  el.teamTag.textContent=t.name; el.teamTag.className='teamTag '+t.color; el.teamTag.style.display='inline-block';
}

function pickTeam(){ // —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—ã–±–æ—Ä
  $('#intro').style.display='none';
  $('#teamScreen').style.display='';
}

// –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã —Å —ç–∫—Ä–∞–Ω–∞
function chooseTeam(teamId){
  const t = TEAMS.find(x=>x.id===teamId);
  if(!t) return;
  applyTeam(t);
  // –ø–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫—Ä—É–ø–Ω–æ
  const big = document.getElementById('bigTeam');
  const chosenWrap = document.getElementById('chosenWrap');
  big.textContent = t.name;
  big.className = 'teamName ' + (t.color||'');
  chosenWrap.style.display = '';
}

// ===== –ø–æ–∫–∞–∑ –∫–æ–º–Ω–∞—Ç
function showRoom(){
  const r=ROOMS[idx]; if(!r)return showFinal();
  el.room.style.display=''; el.final.style.display='none'; el.teamScreen.style.display='none';
  el.hero.style.backgroundImage=`url('${r.img}')`;
  el.title.textContent=r.title; el.story.textContent=r.story;
  el.task.innerHTML=''; el.result.textContent=''; el.next.classList.remove('show');
  el.progress.textContent=`–ö–æ–º–Ω–∞—Ç–∞ ${idx+1} –∏–∑ ${ROOMS.length}`;
  r.render(el.task,{check(ok){
    if(ok){ el.result.textContent='‚úî –í–µ—Ä–Ω–æ!'; el.result.className='notice ok'; el.next.classList.add('show'); }
    else  { el.result.textContent='‚úñ –ù–µ–≤–µ—Ä–Ω–æ.'; el.result.className='notice fail'; }
  }});
}

function nextRoom(){ idx++; localStorage.setItem('hn_idx', idx); if(idx>=ROOMS.length) showFinal(); else showRoom(); }
function showFinal(){ el.room.style.display='none'; el.final.style.display=''; el.finalTeam.textContent=`–ö–æ–º–∞–Ω–¥–∞: ${team?team.name:'‚Äî'}`; }
function resetAll(){ localStorage.removeItem('hn_team'); localStorage.removeItem('hn_idx'); location.reload(); }

// ===== —Å–æ–±—ã—Ç–∏—è
el.btnStart.onclick = pickTeam;
document.getElementById('chooseGhosts').onclick = ()=> chooseTeam('ghosts');
document.getElementById('chooseHunters').onclick = ()=> chooseTeam('hunters');
document.getElementById('readyBtn').onclick = ()=>{ document.getElementById('teamScreen').style.display='none'; idx=0; showRoom(); };
el.next.onclick=nextRoom;
el.btnReset.onclick=resetAll;
// –∫–Ω–æ–ø–∫–∞ —Ñ–∏–Ω–∞–ª–∞ ‚Äî –≤ –º–µ–Ω—é
el.playAgain.addEventListener('click', () => { window.location.href = "https://irinaburljaeva.github.io/halloweennight"; });

// –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–µ—Å–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª–∏)
(function restore(){
  try{
    const t = JSON.parse(localStorage.getItem('hn_team')||'null');
    const i = +(localStorage.getItem('hn_idx')||'0');
    if (t){ applyTeam(t); }
    if (t && i>0){
      idx = i;
      $('#intro').style.display='none';
      showRoom();
    }
  }catch(e){}
})();
</script>
</body>
</html>
