<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Таинственный дом — командный квест</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background-color: #0d0e10;
    color: #f3f3f3;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  .container {
    max-width: 800px;
    padding: 20px;
    text-align: center;
  }
  h1, h2 { color: #ffb703; }
  img {
    max-width: 100%;
    border-radius: 10px;
    margin: 12px 0;
  }
  button {
    background: #ffb703;
    color: #1a1a1a;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 15px;
  }
  button:hover { background: #ffcb45; }
  input {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #333;
    margin-top: 8px;
    background: #1a1a1a;
    color: #fff;
    text-align: center;
    font-size: 16px;
  }
  .hidden { display: none; }
  .ok { color: #22c55e; font-weight: bold; }
</style>
</head>
<body>
  <div class="container">
    <h1>Таинственный дом</h1>
    <div id="game"></div>
  </div>

<script>
const $ = s => document.querySelector(s);
const state = { step: 0, team: null };

const ROOMS = [
  {
    key: 'intro',
    title: 'Распределение на команды',
    img: 'intro.png',
    story: 'Дом шепчет свои тайны… Он делит вас на команды. Подождите и узнайте, с кем вы сражаетесь бок о бок.',
    render(container, helpers) {
      container.innerHTML = `
        <p>Команды: <b>Тёплые огни</b> и <b>Ночные искатели</b></p>
        <button id="assign">Распределить команду</button>
        <div id="teamResult" class="hidden">
          <h2 id="teamName"></h2>
          <p>Разделитесь в реальности на команды и готовьтесь к испытанию.</p>
          <button id="goStart">Войти в дом</button>
        </div>`;
      $("#assign").onclick = () => {
        const team = Math.random() < 0.5 ? 'Тёплые огни' : 'Ночные искатели';
        state.team = team;
        $("#assign").classList.add('hidden');
        $("#teamResult").classList.remove('hidden');
        $("#teamName").textContent = team;
      };
      $("#goStart").onclick = () => helpers.next();
    }
  },
  {
    key: 'library',
    title: 'Комната 1. Библиотека — «Ключ из букв»',
    img: 'library.png',
    story: 'Дверь хлопает за вами. Пахнет пылью и старой бумагой. На столе лежит записка: «Знание — это дверь. Открой её словом».',
    render(container, helpers) {
      container.innerHTML = `
        <p>Найдите в квартире предметы, начинающиеся на буквы <b>К, Н, И, Г, А</b>.<br>
        Примеры: кружка, носок, игрушка, гребень, альбом.<br>
        Первые буквы сложите в слово и введите его ниже.</p>
        <input id="ans1" placeholder="введите слово">
        <button id="check1">Проверить</button>
        <p id="res1"></p>`;
      $("#check1").onclick = () => {
        const val = $("#ans1").value.trim().toLowerCase();
        if (val === "книга") {
          $("#res1").innerHTML = `<span class="ok">Верно! Полки дрогнули и открыли проход...</span>`;
          setTimeout(helpers.next, 800);
        } else $("#res1").textContent = "Попробуйте ещё раз.";
      };
    }
  },
  {
    key: 'alchemy',
    title: 'Комната 2. Алхимик — «Зелье спокойствия»',
    img: 'alchemy.png',
    story: 'Сияют колбы, пахнет чаем и специями. Дом ждёт, когда вы приготовите зелье вместе.',
    render(container, helpers) {
      container.innerHTML = `
        <p><b>Сварите зелье «Спокойствия»:</b></p>
        <ol>
          <li>Кружка горячего чая (чёрный или зелёный).</li>
          <li>Добавьте ягоды или ложку варенья.</li>
          <li>Размешайте ложку мёда.</li>
          <li>Щепотку корицы или имбиря.</li>
          <li>По желанию немного молока.</li>
        </ol>
        <p>Когда готово и ведущая одобряет — нажмите кнопку.</p>
        <button id="hold">Ведущая подтверждает</button>
        <p id="res2"></p>`;
      let t = null;
      $("#hold").addEventListener("pointerdown", () => {
        t = setTimeout(() => {
          $("#res2").innerHTML = `<span class="ok">Дом доволен. Зелье согрело стены...</span>`;
          setTimeout(helpers.next, 800);
        }, 2000);
      });
      ["pointerup","pointerleave","pointercancel"].forEach(ev =>
        $("#hold").addEventListener(ev, () => clearTimeout(t))
      );
    }
  },
  {
    key: 'mirrors',
    title: 'Комната 3. Зеркала — «Эстафета отражений»',
    img: 'mirrors.png',
    story: 'Стены отражают каждое движение. Шёпот домовёнка: «Только те, кто действуют как одно, пройдут дальше».',
    render(container, helpers) {
      container.innerHTML = `
        <p>Первый игрок показывает движение. Следующий повторяет и добавляет своё.<br>
        Когда цепочка выполнена без ошибок — ведущая подтверждает.</p>
        <button id="hold2">Ведущая подтверждает</button>
        <p id="res3"></p>`;
      let t = null;
      $("#hold2").addEventListener("pointerdown", () => {
        t = setTimeout(() => {
          $("#res3").innerHTML = `<span class="ok">Отражения сложились. Путь открыт!</span>`;
          setTimeout(helpers.next, 800);
        }, 2000);
      });
      ["pointerup","pointerleave","pointercancel"].forEach(ev =>
        $("#hold2").addEventListener(ev, () => clearTimeout(t))
      );
    }
  },
  {
    key: 'door',
    title: 'Финальная дверь — «Три замка»',
    img: 'door.png',
    story: 'На массивной двери три замка. Чтобы выбраться, нужно разгадать их все.',
    render(container, helpers) {
      container.innerHTML = `
        <p><b>Замок I:</b> «Без ног хожу, без языка говорю, за солнцем иду, ночью сплю. Кто я?»</p>
        <input id="z1" placeholder="слово-ключ (ж.р.)">
        <p><b>Замок II:</b> «Её не видно, но все чувствуют. Она согревает дом, даже если в нём нет огня. Что это?»</p>
        <input id="z2" placeholder="слово-ключ (ж.р.)">
        <p><b>Замок III:</b> «Она всегда идёт вперёд, никогда не возвращается, и никто не может её остановить. Что это?»</p>
        <input id="z3" placeholder="слово-ключ (ср.р.)">
        <button id="doorCheck">Проверить</button>
        <p id="res4"></p>`;
      $("#doorCheck").onclick = () => {
        const n = s => s.trim().toLowerCase().replaceAll('ё','е');
        const a1 = n($("#z1").value);
        const a2 = n($("#z2").value);
        const a3 = n($("#z3").value);
        if (a1 === "тень" && a2 === "любовь" && a3 === "время") {
          $("#res4").innerHTML = `<span class="ok">Все замки щёлкнули. Дверь распахнулась — вы выбрались!</span>`;
        } else {
          $("#res4").textContent = "Не все замки открылись. Обсудите и попробуйте снова!";
        }
      };
    }
  }
];

function renderStep() {
  const room = ROOMS[state.step];
  if (!room) return;
  $("#game").innerHTML = `
    <h2>${room.title}</h2>
    <img src="${room.img}" alt="">
    <p>${room.story}</p>`;
  room.render($("#game"), { next: nextStep });
}
function nextStep() {
  state.step++;
  if (state.step >= ROOMS.length) state.step = ROOMS.length - 1;
  renderStep();
}
renderStep();
</script>
</body>
</html>
