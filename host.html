<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Таинственный дом — Командный квест (Host)</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0e0e11; --panel:#181a20; --muted:#b7bac4; --accent:#ffb703;
    --ghost:#7dd3fc; --hunters:#fca5a5;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:#fff; background:var(--bg);
    font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  header{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:16px; position:sticky; top:0; background:#0e0e11e6; backdrop-filter:saturate(130%) blur(6px); z-index:10;
    border-bottom:1px solid #2a2d36;
  }
  h1{margin:0; font-size:clamp(18px,3.4vw,32px); line-height:1.1}
  .btn{border:none; border-radius:12px; padding:10px 14px; font-weight:900; cursor:pointer}
  .btn.primary{background:var(--accent); color:#000}
  .btn.secondary{background:#252a34; color:#fff}
  .teamTag{display:none; border:1px solid #ffffff1a; border-radius:999px; padding:8px 12px; font-weight:800}
  .teamTag.ghost{display:inline-block; background:color-mix(in oklab, var(--ghost) 20%, #000 80%); color:#e9f9ff}
  .teamTag.hunters{display:inline-block; background:color-mix(in oklab, var(--hunters) 20%, #000 80%); color:#fff2f2}
  .wrap{max-width:980px; margin:20px auto; padding:0 16px}
  .card{
    background:linear-gradient(180deg,#1a1d24 0%,#12151a 100%);
    border:1px solid #2b2f39; border-radius:18px; overflow:hidden;
    box-shadow:0 20px 80px #0008;
  }
  .roomHero{
    aspect-ratio:16/9; width:100%; background:#0d0f14 center/cover no-repeat;
    border-bottom:1px solid #2b2f39; position:relative;
  }
  .roomBody{padding:18px}
  .roomTitle{margin:0 0 8px; font-size:clamp(20px,3vw,28px)}
  .story{color:#e6e7ec; margin:0 0 8px}
  .muted{color:var(--muted)}
  .inputRow{display:flex; gap:10px; margin-top:12px}
  input[type=text]{flex:1; padding:12px 14px; border-radius:12px; border:1px solid #2f3340; background:#0f1116; color:#fff; outline:none}
  .notice{margin-top:8px; font-weight:700}
  .ok{color:#9dffb2}
  .fail{color:#ffb4b4}
  .foot{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:14px}
  .nextBtn{display:none}
  .nextBtn.show{display:inline-block}
  .overlay{position:fixed; inset:0; display:none; place-items:center; background:#000a; z-index:20}
  .overlay.show{display:grid}
  .splash{
    width:min(720px,92vw); background:linear-gradient(180deg,#1b1e26 0%,#12151a 100%);
    border:1px solid #2b2f39; border-radius:18px; padding:22px; text-align:center;
  }
  .teamName{font-size:clamp(28px,5vw,44px); margin:6px 0 14px}
  .teamName.ghost{color:var(--ghost)}
  .teamName.hunters{color:var(--hunters)}
  .progress{margin:8px 0 0; color:#bfc3ce; font-size:14px}
</style>
</head>
<body>
<header>
  <h1>Таинственный дом — Командный квест</h1>
  <div style="display:flex;gap:8px;align-items:center">
    <div id="teamTag" class="teamTag" aria-live="polite"></div>
    <button id="btnStart" class="btn primary" type="button">Старт</button>
    <button id="btnReset" class="btn secondary" type="button">Сброс</button>
  </div>
</header>

<div class="wrap">
  <section id="intro" class="card">
    <div class="roomHero" style="background-image:url('door.png');"></div>
    <div class="roomBody">
      <p class="story">
        Хэллоуин. Свет мигает, ветер воет — и вы находите старый дом. Он сам делит гостей на две команды
        и впускает только тех, кто решает загадки. Нажмите <b>«Старт»</b>, чтобы узнать свою команду
        и войти внутрь.
      </p>
      <p class="muted">Подсказок на экране минимум — всё делаем вместе офлайн.</p>
    </div>
  </section>

  <section id="room" class="card" style="display:none">
    <div id="roomHero" class="roomHero"></div>
    <div class="roomBody">
      <h2 id="roomTitle" class="roomTitle"></h2>
      <p id="roomStory" class="story"></p>
      <p id="roomIrl" class="muted"></p>

      <div class="inputRow">
        <input id="answer" type="text" placeholder="введите ответ"/>
        <button id="check" class="btn secondary" type="button">Проверить</button>
      </div>
      <div id="result" class="notice"></div>

      <div class="foot">
        <div class="progress" id="progressText">Комната 1 из 4</div>
        <button id="next" class="btn primary nextBtn" type="button">Дальше</button>
      </div>
    </div>
  </section>

  <section id="final" class="card" style="display:none">
    <div class="roomHero" style="background-image:url('door.png');"></div>
    <div class="roomBody">
      <h2 class="roomTitle">Выбрались!</h2>
      <p class="story">Скрип двери стихает. Дом принимает вас — и отпускает. Отличная работа, команда!</p>
      <p id="finalTeam" class="muted"></p>
      <button id="playAgain" class="btn secondary" type="button">Сыграть ещё раз</button>
    </div>
  </section>
</div>

<!-- Оверлей команды -->
<div id="overlay" class="overlay" aria-modal="true" role="dialog">
  <div class="splash">
    <div class="muted">Ваша команда</div>
    <div id="teamName" class="teamName">—</div>
    <p class="muted" style="margin-top:-6px">Разделитесь офлайн и действуйте вместе. Нажмите, чтобы войти в дом.</p>
    <button id="enter" class="btn primary" type="button">Войти в дом</button>
  </div>
</div>

<script>
  // ===== Команды
  const TEAMS = [
    { id:'ghosts',  name:'ПРИЗРАКИ', color:'ghost'   },
    { id:'hunters', name:'ОХОТНИКИ', color:'hunters' }
  ];

  // ===== Комнаты (твои картинки)
  const ROOMS = [
    {
      key:'library',
      title:'Библиотека',
      img:'library.png',
      story:'Пыльные полки и картотека. На столе шёпотом пишет перо.',
      irl:'Найдите в комнате три «шуршащих» предмета и положите их на стол. Первые буквы слов составляют пароль.',
      answer:'КНИГА', // можно изменить
      accept:(v)=> v.trim().toUpperCase()==='КНИГА'
    },
    {
      key:'alchemy',
      title:'Комната алхимика',
      img:'alchemy.png',
      story:'Колбы, аромат корицы и цитруса. На стене формула, где вместо знака вопроса — слово.',
      irl:'Соберите ингредиенты для «осеннего чая»: корица + цитрус + вода. Скажитесь вместе «готово». Пароль — слово «ЧАЙ».',
      answer:'ЧАЙ',
      accept:(v)=> v.trim().toUpperCase()==='ЧАЙ'
    },
    {
      key:'mirrors',
      title:'Зал зеркал',
      img:'mirrors.png',
      story:'Отражения множатся, буквы путаются. На полу надпись наоборот.',
      irl:'Найдите где-нибудь слово, написанное наоборот, и прочтите его вслух. Пароль — это слово «ВАЛЬС».',
      answer:'ВАЛЬС',
      accept:(v)=> v.trim().toUpperCase()==='ВАЛЬС'
    },
    {
      key:'door',
      title:'Финальная дверь',
      img:'door.png',
      story:'Гравировка: «Назовите вслух имя вашей команды и скажите: “Мы готовы выйти”».',
      irl:'После подтверждения ведущим введите финальный пароль: «ОСЕНЬ».',
      answer:'ОСЕНЬ',
      accept:(v)=> v.trim().toUpperCase()==='ОСЕНЬ'
    }
  ];

  // ===== Селекторы
  const $ = (s)=>document.querySelector(s);
  const el = {
    teamTag: $('#teamTag'),
    btnStart: $('#btnStart'),
    btnReset: $('#btnReset'),
    overlay: $('#overlay'),
    teamName: $('#teamName'),
    enter: $('#enter'),
    intro: $('#intro'),
    room: $('#room'),
    hero: $('#roomHero'),
    title: $('#roomTitle'),
    story: $('#roomStory'),
    irl: $('#roomIrl'),
    answer: $('#answer'),
    check: $('#check'),
    result: $('#result'),
    next: $('#next'),
    progress: $('#progressText'),
    final: $('#final'),
    finalTeam: $('#finalTeam'),
    playAgain: $('#playAgain')
  };

  // ===== Состояние
  let team = null;
  let idx = 0;

  // загрузка из localStorage
  (function loadState(){
    const t = localStorage.getItem('hn_team');
    const i = localStorage.getItem('hn_idx');
    if (t){ try{ team = JSON.parse(t);}catch{} }
    if (i){ idx = +i || 0; }
    if (team){ applyTeam(team); }
    if (team && idx>0){ // уже играем
      showRoom();
      el.intro.style.display='none';
    }
  })();

  // ===== Логика команд
  function applyTeam(t){
    team = t;
    localStorage.setItem('hn_team', JSON.stringify(t));
    el.teamTag.textContent = t.name;
    el.teamTag.className = 'teamTag ' + (t.color||'');
  }

  function pickTeam(){
    const t = TEAMS[Math.floor(Math.random()*TEAMS.length)];
    applyTeam(t);
    el.teamName.textContent = t.name;
    el.teamName.className = 'teamName ' + (t.color||'');
    el.overlay.classList.add('show');
  }

  // ===== Показ комнаты
  function showRoom(){
    const room = ROOMS[idx];
    if (!room){ return showFinal(); }
    el.room.style.display = '';
    el.hero.style.backgroundImage = `url('${room.img}')`;
    el.title.textContent = room.title;
    el.story.textContent = room.story;
    el.irl.textContent = 'IRL: ' + room.irl;
    el.answer.value='';
    el.result.textContent='';
    el.result.className='notice';
    el.next.classList.remove('show');
    el.progress.textContent = `Комната ${idx+1} из ${ROOMS.length}`;
  }

  function showFinal(){
    el.room.style.display='none';
    el.final.style.display='';
    el.finalTeam.textContent = `Команда: ${team?team.name:'—'}`;
    localStorage.removeItem('hn_idx');
  }

  // ===== Проверка ответа
  function checkAnswer(){
    const v = el.answer.value || '';
    const ok = ROOMS[idx].accept(v);
    if (ok){
      el.result.textContent = '✔ Верно! Можно дальше.';
      el.result.className = 'notice ok';
      el.next.classList.add('show');
    } else {
      el.result.textContent = '✖ Не то. Попробуйте иначе…';
      el.result.className = 'notice fail';
    }
  }

  function nextRoom(){
    idx++;
    localStorage.setItem('hn_idx', String(idx));
    if (idx>=ROOMS.length){ showFinal(); }
    else { showRoom(); window.scrollTo({top:0,behavior:'smooth'}); }
  }

  function resetAll(){
    localStorage.removeItem('hn_team');
    localStorage.removeItem('hn_idx');
    location.href = location.pathname + '?v=' + Date.now();
  }

  // ===== События
  el.btnStart.addEventListener('click', pickTeam);
  el.btnReset.addEventListener('click', resetAll);
  el.enter.addEventListener('click', ()=>{
    el.overlay.classList.remove('show');
    el.intro.style.display='none';
    idx = 0;
    localStorage.setItem('hn_idx','0');
    showRoom();
  });
  el.check.addEventListener('click', checkAnswer);
  el.answer.addEventListener('keydown', (e)=>{ if(e.key==='Enter') checkAnswer(); });
  el.next.addEventListener('click', nextRoom);
  el.playAgain.addEventListener('click', resetAll);
</script>
</body>
</html>
