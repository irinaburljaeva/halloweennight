<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ночная Игра</title>
<style>
  :root{
    --orange:#CF2C02; --yellow:#FFBA08; --bg:#0a0a0f; --panel:#14141d; --line:#2b2b3a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Arial, sans-serif;color:#fff;background:var(--bg)}
  .hero{
    position:relative; min-height:52vh; display:grid; place-items:center; text-align:center; overflow:hidden;
    background:#09090f;
  }
  .hero::before{
    content:""; position:absolute; inset:0;
    background:url("./intro.png") center/cover no-repeat; filter:brightness(.65) saturate(1.1);
  }
  .veil{position:absolute; inset:0; background:radial-gradient(80% 60% at 50% 20%, rgba(0,0,0,.0), rgba(0,0,0,.55) 60%, rgba(0,0,0,.85))}
  .hero-inner{position:relative; padding:24px}
  h1{margin:0 0 8px; font-size:clamp(28px,5vw,44px); letter-spacing:.5px}
  .tagline{opacity:.9; font-size:clamp(14px,2.6vw,18px)}
  .wrap{max-width:1050px; margin:auto; padding:22px}
  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:16px; margin-top:-48px}
  .card{
    background:linear-gradient(180deg,#181824,#12121a); border:1px solid var(--line);
    border-radius:16px; padding:18px; display:flex; flex-direction:column; gap:8px; box-shadow:0 10px 30px rgba(0,0,0,.35)
  }
  .card h3{margin:0 0 4px; font-size:20px}
  .teaser{opacity:.9; min-height:3.6em}
  .btns{display:flex; gap:8px; margin-top:auto}
  button, .ghost-btn{
    cursor:pointer; border:0; border-radius:12px; padding:10px 14px; font-weight:700
  }
  .choose{background:var(--yellow); color:#000}
  .open{background:#26263a; color:#fff; border:1px solid #34344a}
  .footer{opacity:.7; text-align:center; margin:18px 0 10px; font-size:13px}
  dialog{background:#14141d; color:#fff; border:1px solid var(--line); border-radius:18px; max-width:720px; padding:0}
  dialog::backdrop{background:rgba(0,0,0,.55)}
  .modal-head{display:flex; justify-content:space-between; align-items:center; padding:14px 16px; border-bottom:1px solid var(--line)}
  .modal-body{padding:16px}
  .x{background:#232334; color:#fff; border:1px solid #34344a; border-radius:10px; padding:6px 10px}
  .qr-wrap{display:grid; place-items:center; gap:10px}
  #qrcode{background:#0d0d14; padding:14px; border-radius:12px; border:1px solid #2a2a3a}
  .hint{opacity:.8; font-size:13px; text-align:center}
  .note{opacity:.72; font-size:12px; text-align:center; margin-top:8px}
</style>
</head>
<body>

  <section class="hero">
    <div class="veil"></div>
    <div class="hero-inner">
      <h1>Ночная Игра</h1>
      <div class="tagline">Выберите тропу. Каждая ведёт к испытанию. Правила узнаешь, когда войдёшь.</div>
    </div>
  </section>

  <main class="wrap">
    <div class="grid">
      <!-- Активность 1 -->
      <article class="card" data-path="hunt.html">
        <h3>Тропа Меток</h3>
        <div class="teaser">Следы разбросаны повсюду. Видит их только тот, кто готов стать охотником.</div>
        <div class="btns">
          <button class="choose">Показать QR</button>
          <a class="open ghost-btn" href="./hunt.html">Открыть</a>
        </div>
      </article>

      <!-- Активность 2 -->
      <article class="card" data-path="bingo.html">
        <h3>Карта Случайностей</h3>
        <div class="teaser">Мир ведёт счёт. Замечай знаки — они складываются в линию судьбы.</div>
        <div class="btns">
          <button class="choose">Показать QR</button>
          <a class="open ghost-btn" href="./bingo.html">Открыть</a>
        </div>
      </article>

      <!-- Активность 3 -->
      <article class="card" data-path="padlock.html">
        <h3>Печать Сейфа</h3>
        <div class="teaser">Четыре знака, и дверь послушно вздохнёт. Если знаешь, где искать шёпот.</div>
        <div class="btns">
          <button class="choose">Показать QR</button>
          <a class="open ghost-btn" href="./padlock.html">Открыть</a>
        </div>
      </article>
    </div>

    <div class="footer">Откройте эту страницу на телевизоре. Выбираем тропу — показывается QR. Остальное — узнаете внутри.</div>
  </main>
<article class="card" data-path="host.html">
  <h3>Командный Ритуал</h3>
  <div class="teaser">Две силы. Один зал. Раунды откроются тем, кто знает слово-ключ.</div>
  <div class="btns">
    <button class="choose">Показать QR</button>
    <a class="open ghost-btn" href="./host.html">Открыть</a>
  </div>
</article>
  <!-- Модал с QR -->
  <dialog id="qrModal">
    <div class="modal-head">
      <strong id="qrTitle">QR для входа</strong>
      <form method="dialog"><button class="x">✕</button></form>
    </div>
    <div class="modal-body">
      <div class="qr-wrap">
        <div id="qrcode"></div>
        <div class="hint">
          Наведи камеру телефона и войди. Ссылку можно открыть и вручную:
          <div id="qrLink" style="word-break:break-all; margin-top:6px; opacity:.85"></div>
        </div>
        <div class="note">Совет ведущему: раздавать QR только на выбранную активность, чтобы сохранить интригу.</div>
      </div>
    </div>
  </dialog>

<script>
/* --------- QRCode минимальная реализация (qrcode.js, сильно укороченная) --------- */
/* Источник: davidshimjs/qrcodejs (MIT). Слегка минифицировано и встроено офлайн.    */
!function(o){function t(o){this.mode=l.MODE_8BIT_BYTE,this.data=o,this.parsedData=[];for(var t=0,r=this.data.length;t<r;t++){var e=[],n=this.data.charCodeAt(t);n>65536?(e[0]=240|(1835008&n)>>>18,e[1]=128|(258048&n)>>>12,e[2]=128|(4032&n)>>>6,e[3]=128|63&n):n>2048?(e[0]=224|(61440&n)>>>12,e[1]=128|(4032&n)>>>6,e[2]=128|63&n):n>128?(e[0]=192|(1984&n)>>>6,e[1]=128|63&n):e[0]=n,this.parsedData.push(e)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.getLength=function(){return this.parsedData.length},this.write=function(o){for(var t=0,r=this.parsedData.length;t<r;t++)o.put(this.parsedData[t],8)}}function r(o,t){this.typeNumber=o,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[],this.addData=function(o){this.dataList.push(new t(o))},this.isDark=function(o,t){if(null==this.modules[o][t])throw new Error(o+","+t);return this.modules[o][t]},this.getModuleCount=function(){return this.moduleCount},this.make=function(){this.makeImpl(!1,this.getBestMaskPattern())},this.makeImpl=function(o,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[r]=new Array(this.moduleCount);this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupTimingPattern(),this.setupTypeInfo(o,t),this.dataCache=this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList),this.mapData(this.dataCache,t)},this.setupPositionProbePattern=function(o,t){for(var r=-1;r<=7;r++)if(!(o+r<=-1||this.moduleCount<=o+r))for(var e=-1;e<=7;e++)t+e<=-1||this.moduleCount<=t+e||(this.modules[o+r][t+e]=r>=0&&r<=6&&(0==e||6==e)||e>=0&&e<=6&&(0==r||6==r)||r>=2&&r<=4&&e>=2&&e<=4)},this.setupTimingPattern=function(){for(var o=8;o<this.moduleCount-8;o++)null==this.modules[o][6]&&(this.modules[o][6]=o%2==0),null==this.modules[6][o]&&(this.modules[6][o]=o%2==0)},this.setupTypeInfo=function(o,t){for(var r=l.getBCHTypeInfo(this.errorCorrectLevel<<3|t),e=0;e<15;e++){var n=!o&&1==(32768&r>>e);e<6?this.modules[e][8]=n:e<8?this.modules[e+1][8]=n:this.modules[this.moduleCount-15+e][8]=n}for(e=0;e<15;e++){n=!o&&1==(32768&r>>e);e<8?this.modules[8][this.moduleCount-e-1]=n:e<9?this.modules[8][15-e-1+1]=n:this.modules[8][15-e-1]=n}this.modules[this.moduleCount-8][8]=!o};var e,n,a=[[],[6,18],[6,22],[6,26],[6,30]];this.mapData=function(o,t){for(var r=-1,e=this.moduleCount-1,n=7,a=0,i=this.moduleCount-1;i>0;i-=2)for(6==i&&i--;;){for(var s=0;s<2;s++)null==this.modules[e][i-s]&&(this.modules[e][i-s]=1==(255&o[a>>>3]>>>7-(a&7)),a++);if((e+=r)<0||this.moduleCount<=e){e-=r,r=-r;break}}}}function e(o,t){for(var r=new r(o,t),e=0;e<arguments.length-2;e++)r.addData(arguments[e+2]);return r.make(),r}var l={};l.PAD0=236,l.PAD1=17,l.MODE_8BIT_BYTE=4,l.QRCodeModel=r,l.QR8bitByte=t,l.QRErrorCorrectLevel={L:1,M:0,Q:3,H:2},l.getBCHTypeInfo=function(o){for(var t=o<<10;l.getBCHDigit(t)-l.getBCHDigit(1335)>=0;)t^=1335<<l.getBCHDigit(t)-l.getBCHDigit(1335);return o<<10|t},l.getBCHDigit=function(o){var t=0;for(;0!=o;)t++,o>>>=1;return t},l.createStringToBytes=function(o){return function(t){for(var r=[],e=0;e<t.length;e++){var l=t.charCodeAt(e);r.push(l&255)}return r}}(""),o.QRCode=function(o,t){this._el=o,this._htOption=t},o.QRCode.prototype.makeCode=function(o){var t=new e(4,l.QRErrorCorrectLevel.M,o),r=t.getModuleCount(),n=document.createElement("canvas");n.width=n.height=260;var a=n.getContext("2d");a.fillStyle="#fff",a.fillRect(0,0,260,260),a.fillStyle="#000";for(var i=0;i<r;i++)for(var s=0;s<r;s++)t.isDark(i,s)&&a.fillRect(5+s*10,5+i*10,10,10);this._el.innerHTML="",this._el.appendChild(n)} }(window);
/* ------------------------------- /QR --------------------------------------- */

const modal=document.getElementById('qrModal');
const qrBox=document.getElementById('qrcode');
const qrLink=document.getElementById('qrLink');
const qrTitle=document.getElementById('qrTitle');

function showQR(title, path){
  const url = new URL(path, location.origin + location.pathname.replace(/[^/]*$/, "")); // корректная база для GH Pages
  qrTitle.textContent = title;
  new QRCode(qrBox, {text:url.toString()}); // (наша мини версия принимает только строку)
  qrLink.textContent = url.toString();
  modal.showModal();
}
modal.addEventListener('close', ()=>{ qrBox.innerHTML=""; });

document.querySelectorAll('.card .choose').forEach(btn=>{
  btn.addEventListener('click', e=>{
    const card = e.currentTarget.closest('.card');
    const title = card.querySelector('h3').textContent;
    const path = card.getAttribute('data-path');
    showQR(title, path);
  });
});
</script>
</body>
</html>
