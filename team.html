<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d0f14; --panel:#151823; --accent:#ffb703; --ok:#66e3ff; --hun:#ffd166; --muted:#aeb4c2;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:'Montserrat',sans-serif; color:#fff;
  background:
    radial-gradient(1200px 600px at 50% -10%, #1d2130 0%, transparent 60%),
    radial-gradient(600px 400px at 10% 90%, #171a25 0%, transparent 60%),
    #0b0d12;
  min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
}
.container{width:100%; max-width:720px; text-align:center}
h1{margin:0 0 8px; font-weight:900; font-size:clamp(24px,5vw,40px)}
.lead{color:var(--muted); margin:0 0 18px; min-height:20px}
.panel{
  background:linear-gradient(180deg,#171a24 0%,#12141c 100%);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px; padding:24px;
  box-shadow:0 10px 40px rgba(0,0,0,.35);
}

/* –°–µ–Ω—Å–æ—Ä */
.scan-wrap{position:relative; width:min(80vw,420px); height:min(80vw,420px); margin:10px auto 10px}
.scan-circle{
  position:absolute; inset:0; border-radius:50%;
  background: radial-gradient(60% 60% at 50% 40%, #22283a 0%, #151a28 55%, #0f1320 100%);
  box-shadow: inset 0 0 50px rgba(0,0,0,.6), 0 0 60px rgba(0,0,0,.35);
  display:flex; align-items:center; justify-content:center; overflow:hidden; cursor:pointer;
  border:1px solid rgba(255,255,255,.05);
  transition: box-shadow .2s ease, outline-color .2s ease, transform .08s ease;
}
.scan-circle.touching{
  box-shadow: inset 0 0 60px rgba(0,0,0,.65),
              0 0 70px rgba(255,183,3,.25),
              0 0 22px rgba(255,183,3,.25);
  transform: scale(1.005);
}
.ripple{
  position:absolute; border-radius:50%; pointer-events:none;
  border:2px solid rgba(255,183,3,.35);
  left:50%; top:50%; width:10px; height:10px; transform:translate(-50%,-50%);
  animation:ripple 650ms ease-out forwards;
  filter: drop-shadow(0 0 6px rgba(255,183,3,.35));
}
@keyframes ripple{
  from{opacity:.55; transform:translate(-50%,-50%) scale(1)}
  to{opacity:0; transform:translate(-50%,-50%) scale(16)}
}

.hand{ width:90px; height:90px; border-radius:50%;
  background: radial-gradient(circle at 35% 35%, #ffd166, #ff9e00);
  box-shadow:0 0 18px rgba(255,158,0,.45);
  position:relative; transform:translateY(6px);
}
.hand:after{ content:"üëá"; font-size:38px; position:absolute; inset:0; display:grid; place-items:center; filter:drop-shadow(0 2px 2px rgba(0,0,0,.4)); }

.spinner{ position:absolute; width:92%; height:92%; border-radius:50%; inset:4%;
  border:3px dashed rgba(255,255,255,.18); animation:spin 1.5s linear infinite; display:none }
@keyframes spin{to{transform:rotate(360deg)}}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å */
.progress{width:80%; height:10px; margin:8px auto 0; background:#0f1422; border-radius:8px; overflow:hidden; display:none}
.progress>span{display:block; height:100%; width:0%; background:linear-gradient(90deg,#ffb703,#ffd166); border-radius:8px; transition:width .18s}
.phase{min-height:24px; color:#adb3c4; margin-top:6px; font-size:14px; display:none}

/* –†–µ–∑—É–ª—å—Ç–∞—Ç */
.result{margin:10px 0 14px; font-size:clamp(18px,3.8vw,26px); font-weight:900; display:none}
.result.ghost{color:var(--ok); text-shadow:0 0 12px rgba(102,227,255,.35)}
.result.hunter{color:var(--hun); text-shadow:0 0 12px rgba(255,209,102,.35)}

/* –ö–Ω–æ–ø–∫–∏ */
.actions{display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:12px}
.btn{
  padding:14px 18px; border:none; border-radius:12px; cursor:pointer; font-weight:800;
  background:#2a2f42; color:#fff; transition:.25s;
}
.btn-primary{background:var(--accent); color:#000; box-shadow:0 6px 16px rgba(255,183,3,.25)}
.btn:hover{transform:translateY(-2px)}
</style>
</head>
<body>
  <div class="container">
    <h1 id="title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º</h1>
    <p class="lead" id="lead">–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –ø–∞–ª–µ—Ü –Ω–∞ —Å–µ–Ω—Å–æ—Ä–µ –∏ –¥–µ—Ä–∂–∏—Ç–µ‚Ä¶</p>

    <div class="panel">
      <div class="scan-wrap">
        <div id="circle" class="scan-circle" aria-label="–°–µ–Ω—Å–æ—Ä –∞–∫—Ç–∏–≤–∞—Ü–∏–∏">
          <div class="hand" id="hand"></div>
          <div class="spinner" id="spinner"></div>
        </div>
      </div>

      <div class="progress" id="progress"><span id="bar"></span></div>
      <div class="phase" id="phase"></div>

      <div id="result" class="result"></div>

      <div class="actions">
        <button class="btn" id="again" style="display:none">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
        <a id="goBtn" class="btn btn-primary" href="#" style="display:none">–í –ú–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –¥–æ–º</a>
      </div>
    </div>
  </div>

<script>
const LS_KEY_TEAM='hn_team';
const LS_KEY_COUNTS='hn_counts_v1';

const circle=document.getElementById('circle');
const spinner=document.getElementById('spinner');
const hand=document.getElementById('hand');
const result=document.getElementById('result');
const goBtn=document.getElementById('goBtn');
const again=document.getElementById('again');
const progress=document.getElementById('progress');
const bar=document.getElementById('bar');
const phase=document.getElementById('phase');
const lead=document.getElementById('lead');

const classFor=t=>t==='ghosts'?'ghost':'hunter';
const story=t=>t==='ghosts'?'üëª –í–∞—à–∞ —ç–Ω–µ—Ä–≥–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ü–†–ò–ó–†–ê–ö–ê–ú!':'üèπ –í–∞—Å –≤—ã–±—Ä–∞–ª–∏ –û–•–û–¢–ù–ò–ö–ò!';

/* —Å—á—ë—Ç—á–∏–∫–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ */
function getCounts(){
  try{const raw=localStorage.getItem(LS_KEY_COUNTS);
    if(!raw)return{ghosts:0,hunters:0};
    const o=JSON.parse(raw);
    return{ghosts:o.ghosts|0,hunters:o.hunters|0};
  }catch{return{ghosts:0,hunters:0}}
}
function setCounts(c){localStorage.setItem(LS_KEY_COUNTS,JSON.stringify(c));}

function chooseBalancedTeam(){
  const c=getCounts(),diff=c.ghosts-c.hunters;
  let t;
  if(diff>=2)t='hunters';
  else if(diff<=-2)t='ghosts';
  else if(diff>0)t=Math.random()<0.65?'hunters':'ghosts';
  else if(diff<0)t=Math.random()<0.65?'ghosts':'hunters';
  else t=Math.random()<0.5?'ghosts':'hunters';
  if(t==='ghosts')c.ghosts++;else c.hunters++;
  setCounts(c);return t;
}

/* –≤–∏–±—Ä–∞—Ü–∏—è –∏ ¬´—Ä—è–±—å¬ª */
function vibrate(p){try{if(navigator.vibrate)navigator.vibrate(p);}catch{}}
function spawnRipple(x,y){
  const r=document.createElement('span');
  r.className='ripple';
  const rect=circle.getBoundingClientRect();
  r.style.left=(x-rect.left)+'px'; r.style.top=(y-rect.top)+'px';
  circle.appendChild(r); r.addEventListener('animationend',()=>r.remove());
}

/* —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–¥–µ—Ä–∂–∞–Ω–∏—è */
let holding=false, scanning=false, aborted=false;
let holdStartTimer=null, scanTickTimer=null, scanEndTimer=null;
let scanTotalMs=0, elapsed=0;

function resetUI(){
  // —Å–±—Ä–æ—Å –ª—é–±—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤
  clearTimeout(holdStartTimer); clearInterval(scanTickTimer); clearTimeout(scanEndTimer);
  holding=false; scanning=false; aborted=false; elapsed=0; scanTotalMs=0;

  // –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å
  spinner.style.display='none';
  progress.style.display='none';
  phase.style.display='none';
  bar.style.width='0%';
  result.style.display='none';
  goBtn.style.display='none';
  again.style.display='none';
  hand.style.display='block';
  lead.textContent='–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –ø–∞–ª–µ—Ü –Ω–∞ —Å–µ–Ω—Å–æ—Ä–µ –∏ –¥–µ—Ä–∂–∏—Ç–µ‚Ä¶';
  circle.classList.remove('touching');
}

/* —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–∑—ã */
const phaseSteps=()=>[
  '–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é –∫–æ–Ω—Ç–∞–∫—Ç‚Ä¶',
  '–°–∫–∞–Ω–∏—Ä—É—é –∞—É—Ä—É‚Ä¶',
  '–†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—é —Å–∏–º–≤–æ–ª—ã‚Ä¶',
  '–°—Ä–∞–≤–Ω–∏–≤–∞—é —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫‚Ä¶',
  `–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Äî ${60+Math.floor(Math.random()*35)}%`
];

/* –∑–∞–ø—É—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —É–¥–µ—Ä–∂–∞–Ω–∏—è */
function startScanning(){
  scanning=true; aborted=false; elapsed=0;
  hand.style.display='none';
  spinner.style.display='block';
  progress.style.display='block';
  phase.style.display='block';
  lead.textContent='–ò–¥—ë—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ‚Ä¶';

  const steps=phaseSteps();
  const stepCount=steps.length;

  scanTotalMs=2800+Math.random()*1200; // 2.8‚Äì4.0 c
  const tick=120;
  let currentStep=0;
  phase.textContent=steps[currentStep];

  scanTickTimer=setInterval(()=>{
    if(!holding){ // –ø–∞–ª–µ—Ü —É–±—Ä–∞–ª–∏ ‚Äî –ø—Ä–µ—Ä—ã–≤–∞–µ–º
      abortScan('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ ‚Äî –ø–∞–ª–µ—Ü —É–±—Ä–∞–Ω. –î–µ—Ä–∂–∏—Ç–µ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.');
      return;
    }
    elapsed+=tick;
    const pct=Math.min(100, Math.floor((elapsed/scanTotalMs)*100));
    bar.style.width=pct+'%';
    const targetStep=Math.min(stepCount-1, Math.floor(pct/ (100/stepCount)));
    if(targetStep!==currentStep){ currentStep=targetStep; phase.textContent=steps[currentStep]; }
    if(elapsed>=scanTotalMs){
      clearInterval(scanTickTimer);
      finishScan();
    }
  }, tick);
}

/* –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
function finishScan(){
  spinner.style.display='none';
  progress.style.display='none';
  phase.style.display='none';
  scanning=false;

  const team=chooseBalancedTeam();
  localStorage.setItem(LS_KEY_TEAM,team);

  result.className='result '+classFor(team);
  result.textContent=story(team);
  result.style.display='block';

  again.style.display='inline-block';
  goBtn.href=`host.html?team=${team}`;
  goBtn.style.display='inline-block';

  lead.textContent='–î–æ–º –ø—Ä–æ–∏–∑–Ω—ë—Å —Å–≤–æ–π –≤–µ—Ä–¥–∏–∫—Ç‚Ä¶';
  vibrate(80);
}

/* –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –ø–∞–ª–µ—Ü —É–±—Ä–∞–ª–∏) */
function abortScan(msg){
  clearInterval(scanTickTimer);
  clearTimeout(scanEndTimer);
  scanning=false; aborted=true;

  spinner.style.display='none';
  progress.style.display='none';
  phase.style.display='none';
  bar.style.width='0%';

  hand.style.display='block';
  result.style.display='none';
  goBtn.style.display='none';
  again.style.display='inline-block';     // –ø–æ–∑–≤–æ–ª–∏–º –±—ã—Å—Ç—Ä–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
  lead.textContent=msg || '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ. –î–µ—Ä–∂–∏—Ç–µ –ø–∞–ª–µ—Ü –¥–æ –∫–æ–Ω—Ü–∞.';
}

/* —Å–æ–±—ã—Ç–∏—è –≤–≤–æ–¥–∞ */
circle.addEventListener('pointerdown',(e)=>{
  if(scanning) return; // —É–∂–µ –∏–¥—ë—Ç —Å–∫–∞–Ω
  holding=true; aborted=false;
  circle.classList.add('touching');
  spawnRipple(e.clientX,e.clientY);
  vibrate(20);

  // –∫–æ—Ä–æ—Ç–∫–∞—è ¬´–∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞¬ª (–∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º)
  lead.textContent='–ö–∞–ª–∏–±—Ä—É—é –∫–æ–Ω—Ç–∞–∫—Ç‚Ä¶ –Ω–µ —É–±–∏—Ä–∞–π—Ç–µ –ø–∞–ª–µ—Ü';
  holdStartTimer=setTimeout(()=>{
    if(holding && !scanning) startScanning();
  }, 500); // –¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 0.5 —Å, –ø–æ—Ç–æ–º –Ω–∞—á–Ω—ë—Ç—Å—è —Å–∫–∞–Ω
});

function endHold(){
  if(!holding) return;
  holding=false;
  circle.classList.remove('touching');

  // –µ—Å–ª–∏ –æ—Ç–ø—É—Å—Ç–∏–ª–∏ –¥–æ —Å—Ç–∞—Ä—Ç–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–±—Ä–æ—Å–∏–º –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ
  if(!scanning){
    clearTimeout(holdStartTimer);
    lead.textContent='–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞. –î–µ—Ä–∂–∏—Ç–µ –ø–∞–ª–µ—Ü –¥–æ–ª—å—à–µ‚Ä¶';
    hand.style.display='block';
    again.style.display='inline-block';
  }
  // –µ—Å–ª–∏ –æ—Ç–ø—É—Å—Ç–∏–ª–∏ –≤–æ –≤—Ä–µ–º—è —Å–∫–∞–Ω–∞ ‚Äî –ø—Ä–µ—Ä–≤—ë–º
  else{
    abortScan('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ ‚Äî –ø–∞–ª–µ—Ü —É–±—Ä–∞–Ω. –î–µ—Ä–∂–∏—Ç–µ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.');
  }
}
circle.addEventListener('pointerup', endHold);
circle.addEventListener('pointerleave', endHold);
document.addEventListener('pointercancel', endHold);

/* –∫–Ω–æ–ø–∫–∞ ¬´–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑¬ª */
again.addEventListener('click', resetUI);

/* –ø–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è */
resetUI();
</script>
</body>
</html>
