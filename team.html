<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d0f14; --panel:#151823; --accent:#ffb703; --ok:#66e3ff; --hun:#ffd166; --muted:#aeb4c2;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:'Montserrat',sans-serif; color:#fff;
  background:
    radial-gradient(1200px 600px at 50% -10%, #1d2130 0%, transparent 60%),
    radial-gradient(600px 400px at 10% 90%, #171a25 0%, transparent 60%),
    #0b0d12;
  min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
}
.container{width:100%; max-width:720px; text-align:center}
h1{margin:0 0 8px; font-weight:900; font-size:clamp(24px,5vw,40px)}
.lead{color:var(--muted); margin:0 0 18px}
.panel{
  background:linear-gradient(180deg,#171a24 0%,#12141c 100%);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px; padding:24px;
  box-shadow:0 10px 40px rgba(0,0,0,.35);
}

/* –°–µ–Ω—Å–æ—Ä */
.scan-wrap{position:relative; width:min(80vw,420px); height:min(80vw,420px); margin:10px auto 10px}
.scan-circle{
  position:absolute; inset:0; border-radius:50%;
  background: radial-gradient(60% 60% at 50% 40%, #22283a 0%, #151a28 55%, #0f1320 100%);
  box-shadow: inset 0 0 50px rgba(0,0,0,.6), 0 0 60px rgba(0,0,0,.35);
  display:flex; align-items:center; justify-content:center; overflow:hidden; cursor:pointer;
  border:1px solid rgba(255,255,255,.05);
  transition: box-shadow .2s ease, outline-color .2s ease, transform .08s ease;
}
.scan-circle.touching{
  box-shadow: inset 0 0 60px rgba(0,0,0,.65),
              0 0 70px rgba(255,183,3,.25),
              0 0 22px rgba(255,183,3,.25);
  transform: scale(1.005);
}
.ripple{
  position:absolute; border-radius:50%; pointer-events:none;
  border:2px solid rgba(255,183,3,.35);
  left:50%; top:50%; width:10px; height:10px; transform:translate(-50%,-50%);
  animation:ripple 650ms ease-out forwards;
  filter: drop-shadow(0 0 6px rgba(255,183,3,.35));
}
@keyframes ripple{
  from{opacity:.55; transform:translate(-50%,-50%) scale(1)}
  to{opacity:0; transform:translate(-50%,-50%) scale(16)}
}

.hand{ width:90px; height:90px; border-radius:50%;
  background: radial-gradient(circle at 35% 35%, #ffd166, #ff9e00);
  box-shadow:0 0 18px rgba(255,158,0,.45);
  position:relative; transform:translateY(6px);
}
.hand:after{ content:"üëá"; font-size:38px; position:absolute; inset:0; display:grid; place-items:center; filter:drop-shadow(0 2px 2px rgba(0,0,0,.4)); }

.spinner{ position:absolute; width:92%; height:92%; border-radius:50%; inset:4%;
  border:3px dashed rgba(255,255,255,.18); animation:spin 1.5s linear infinite; display:none }
@keyframes spin{to{transform:rotate(360deg)}}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å */
.progress{width:80%; height:10px; margin:8px auto 0; background:#0f1422; border-radius:8px; overflow:hidden; display:none}
.progress>span{display:block; height:100%; width:0%; background:linear-gradient(90deg,#ffb703,#ffd166); border-radius:8px; transition:width .18s}
.phase{min-height:24px; color:#adb3c4; margin-top:6px; font-size:14px; display:none}

/* –†–µ–∑—É–ª—å—Ç–∞—Ç */
.result{margin:10px 0 14px; font-size:clamp(18px,3.8vw,26px); font-weight:900; display:none}
.result.ghost{color:var(--ok); text-shadow:0 0 12px rgba(102,227,255,.35)}
.result.hunter{color:var(--hun); text-shadow:0 0 12px rgba(255,209,102,.35)}

/* –ö–Ω–æ–ø–∫–∏ */
.actions{display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:12px}
.btn{
  padding:14px 18px; border:none; border-radius:12px; cursor:pointer; font-weight:800;
  background:#2a2f42; color:#fff; transition:.25s;
}
.btn-primary{background:var(--accent); color:#000; box-shadow:0 6px 16px rgba(255,183,3,.25)}
.btn:hover{transform:translateY(-2px)}
</style>
</head>
<body>
  <div class="container">
    <h1 id="title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º</h1>
    <p class="lead" id="lead">–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –ø–∞–ª–µ—Ü –Ω–∞ —Å–µ–Ω—Å–æ—Ä–µ‚Ä¶</p>

    <div class="panel">
      <div class="scan-wrap">
        <div id="circle" class="scan-circle" aria-label="–°–µ–Ω—Å–æ—Ä –∞–∫—Ç–∏–≤–∞—Ü–∏–∏">
          <div class="hand" id="hand"></div>
          <div class="spinner" id="spinner"></div>
        </div>
      </div>

      <div class="progress" id="progress"><span id="bar"></span></div>
      <div class="phase" id="phase"></div>

      <div id="result" class="result"></div>

      <div class="actions">
        <button class="btn" id="again" style="display:none">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
        <a id="goBtn" class="btn btn-primary" href="#" style="display:none">–í –ú–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –¥–æ–º</a>
      </div>
    </div>
  </div>

<script>
const LS_KEY_TEAM='hn_team';
const LS_KEY_COUNTS='hn_counts_v1';

const circle=document.getElementById('circle');
const spinner=document.getElementById('spinner');
const hand=document.getElementById('hand');
const result=document.getElementById('result');
const goBtn=document.getElementById('goBtn');
const again=document.getElementById('again');
const progress=document.getElementById('progress');
const bar=document.getElementById('bar');
const phase=document.getElementById('phase');
const lead=document.getElementById('lead');

const classFor=t=>t==='ghosts'?'ghost':'hunter';
const story=t=>t==='ghosts'?'üëª –í–∞—à–∞ —ç–Ω–µ—Ä–≥–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ü–†–ò–ó–†–ê–ö–ê–ú!':'üèπ –í–∞—Å –≤—ã–±—Ä–∞–ª–∏ –û–•–û–¢–ù–ò–ö–ò!';

function getCounts(){
  try{const raw=localStorage.getItem(LS_KEY_COUNTS);
    if(!raw)return{ghosts:0,hunters:0};
    const o=JSON.parse(raw);
    return{ghosts:o.ghosts|0,hunters:o.hunters|0};
  }catch{return{ghosts:0,hunters:0}}
}
function setCounts(c){localStorage.setItem(LS_KEY_COUNTS,JSON.stringify(c));}

function chooseBalancedTeam(){
  const c=getCounts(),diff=c.ghosts-c.hunters;
  let t;
  if(diff>=2)t='hunters';
  else if(diff<=-2)t='ghosts';
  else if(diff>0)t=Math.random()<0.65?'hunters':'ghosts';
  else if(diff<0)t=Math.random()<0.65?'ghosts':'hunters';
  else t=Math.random()<0.5?'ghosts':'hunters';
  if(t==='ghosts')c.ghosts++;else c.hunters++;
  setCounts(c);return t;
}

function vibrate(p){try{if(navigator.vibrate)navigator.vibrate(p);}catch{}}

function spawnRipple(x,y){
  const r=document.createElement('span');
  r.className='ripple';
  const rect=circle.getBoundingClientRect();
  const cx=x-rect.left, cy=y-rect.top;
  r.style.left=cx+'px'; r.style.top=cy+'px';
  circle.appendChild(r);
  r.addEventListener('animationend',()=>r.remove());
}

function animatePhases(totalMs){
  const steps=['–°–∫–∞–Ω–∏—Ä—É—é –∞—É—Ä—É‚Ä¶','–†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—é —Å–∏–º–≤–æ–ª—ã‚Ä¶','–°—Ä–∞–≤–Ω–∏–≤–∞—é —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫‚Ä¶',`–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å —ç–Ω–µ—Ä–≥–æ–ø–æ–ª–µ–º ‚Äî ${60+Math.floor(Math.random()*35)}%`];
  let i=0,elapsed=0;phase.style.display='block';progress.style.display='block';bar.style.width='0%';
  const tick=120;const timer=setInterval(()=>{
    elapsed+=tick;
    const pct=Math.min(100,Math.floor((elapsed/totalMs)*100));
    bar.style.width=pct+'%';
    if(pct>(i+1)*25&&i<steps.length-1)i++;
    phase.textContent=steps[i];
    if(elapsed>=totalMs)clearInterval(timer);
  },tick);
}

function startScan(){
  result.style.display='none'; goBtn.style.display='none'; again.style.display='none';
  hand.style.display='none'; spinner.style.display='block';
  lead.textContent='–ò–¥—ë—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ‚Ä¶';
  animatePhases(2600+Math.random()*900);
  const dur=2700+Math.random()*900;
  setTimeout(()=>{
    const team=chooseBalancedTeam();
    localStorage.setItem(LS_KEY_TEAM,team);
    spinner.style.display='none'; phase.style.display='none'; progress.style.display='none';
    result.className='result '+classFor(team);
    result.textContent=story(team);
    result.style.display='block';
    again.style.display='inline-block';
    goBtn.href=`host.html?team=${team}`;
    goBtn.style.display='inline-block';
    lead.textContent='–î–æ–º –ø—Ä–æ–∏–∑–Ω—ë—Å —Å–≤–æ–π –≤–µ—Ä–¥–∏–∫—Ç‚Ä¶';
    vibrate(80);
  },dur);
}

circle.addEventListener('click',(e)=>{
  if(spinner.style.display==='block')return;
  circle.classList.add('touching');
  spawnRipple(e.clientX,e.clientY);
  vibrate(30);
  setTimeout(()=>circle.classList.remove('touching'),250);
  startScan();
});

again.addEventListener('click',()=>{
  // —Å–±—Ä–æ—Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  result.style.display='none';
  goBtn.style.display='none';
  again.style.display='none';
  spinner.style.display='none';
  phase.style.display='none';
  progress.style.display='none';
  bar.style.width='0%';
  hand.style.display='block';
  lead.textContent='–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –ø–∞–ª–µ—Ü –Ω–∞ —Å–µ–Ω—Å–æ—Ä–µ‚Ä¶';
});
</script>
</body>
</html>
