<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Trick-or-Treat Hunt ‚Äî –§–æ—Ç–æ-–∫–≤–µ—Å—Ç</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0e13;
  --card:#121821;
  --muted:#b9c0cf;
  --accent:#ffb703;
  --accent-2:#f77f00;
  --stroke:#253042;
  --ok:#22c55e;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:'Montserrat',sans-serif; color:#fff;
  background: radial-gradient(1200px 800px at 50% -200px, #1a2030 0%, var(--bg) 60%);
}
.container{max-width:980px;margin:24px auto;padding:0 16px}
.header{
  background: linear-gradient(180deg, #182131 0%, #0f141d 100%);
  border:1px solid rgba(255,255,255,.06);
  border-radius:18px; padding:24px 20px; margin-bottom:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
h1{margin:0;font-size:clamp(26px,5vw,42px);line-height:1.1;letter-spacing:.3px}
h1 .em{margin-right:.35em}
.lead{color:var(--muted);margin:12px 0 0;line-height:1.55}
hr.sep{border:none;height:1px;background:#223048;margin:18px 0}

.actions{display:flex;flex-wrap:wrap;gap:12px;margin:16px 0 8px}
.btn{
  appearance:none;border:none;border-radius:12px;padding:12px 16px;font-weight:800;
  cursor:pointer;transition:.2s; font-size:15px;
}
.btn-primary{background:var(--accent);color:#161616}
.btn-ghost{background:#1a2230;color:#e6edf7;border:1px solid var(--stroke)}
.btn:hover{transform:translateY(-1px)}
.note{color:var(--muted);font-size:14px;margin-top:6px}

.grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
.card{
  background:linear-gradient(180deg,#121821 0%,#0f141d 100%);
  border:1px solid var(--stroke); border-radius:16px; overflow:hidden;
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
}
.card .top{padding:14px 14px 0}
.badge{
  display:inline-block;background:#1e2838;border:1px solid var(--stroke);
  padding:6px 10px;border-radius:999px;font-weight:800;font-size:12px;color:#c9d3e6
}
.badge.done{background:#11301d;border-color:#215b36;color:#c6f3d5}
.thumb{
  width:100%; height:180px; margin-top:12px; background:#0f1218;
  border:1px solid #252b36; border-radius:12px; overflow:hidden;
  display:flex; align-items:center; justify-content:center;
}
.thumb img{width:100%;height:100%;object-fit:cover;display:block}

.card .body{padding:14px 16px 18px}
.card h3{margin:10px 0 6px; font-size:20px; line-height:1.2}
.card h3 .em{margin-right:.35em}
.card p{margin:0;color:var(--muted);font-size:14px;line-height:1.5}
.row{display:flex;gap:10px;margin-top:14px;align-items:center;flex-wrap:wrap}
label.btn{display:inline-flex;align-items:center;gap:8px}
.hidden{display:none !important}
</style>
</head>
<body>
<div class="container">
  <section class="header">
    <h1><span class="em">üéÉ</span>Trick-or-Treat Hunt</h1>
    <p class="lead">
      –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã –ø–æ —Å–ø–∏—Å–∫—É –Ω–∏–∂–µ. –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ ‚Äî
      –∏—Ö –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤–µ–¥—É—â–µ–π –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –º–∏–Ω–∏-–∞–ª—å–±–æ–º.
    </p>
    <hr class="sep">
    <div class="actions">
      <button id="exportBtn" class="btn btn-primary">–≠–∫—Å–ø–æ—Ä—Ç ‚Üí HTML-–∞–ª—å–±–æ–º</button>
      <button id="resetBtn" class="btn btn-ghost">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
    </div>
    <p class="note">–ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞: –ª–µ—Ç—É—á–∞—è –º—ã—à—å, –≤–µ–¥—å–º–∞, —Ç—ã–∫–≤–∞, –ø—Ä–∏–∑—Ä–∞–∫, –ø–∞—É–∫, –∑–µ–ª—å–µ. –î–æ–ø—É—Å–∫–∞—é—Ç—Å—è –ª—é–¥–∏ –∏ –ª—é–±—ã–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –æ–±—ä–µ–∫—Ç—ã/–¥–µ–∫–æ—Ä.</p>
  </section>

  <div id="grid" class="grid"><!-- –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ç—É—Ç --></div>
</div>

<script>
/* ---------- –î–ê–ù–ù–´–ï –ó–ê–î–ê–ù–ò–ô ---------- */
const TASKS = [
  { id:'bat',   emoji:'ü¶á', name:'–õ–µ—Ç—É—á–∞—è –º—ã—à—å',         tip:'–§–∏–≥—É—Ä–∞, –Ω–∞–∫–ª–µ–π–∫–∞, —Ä–∏—Å—É–Ω–æ–∫ ‚Äî –≤—Å—ë –ø–æ–¥–æ–π–¥—ë—Ç.' },
  { id:'witch', emoji:'üßô‚Äç‚ôÄÔ∏è', name:'–í–µ–¥—å–º–∞',              tip:'–ö–∞—Ä—Ç–∏–Ω–∞, —Ñ–∏–≥—É—Ä–∫–∞, –∫–æ—Å—Ç—é–º –∏–ª–∏ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–∑–∞.' },
  { id:'pump',  emoji:'üéÉ', name:'–¢—ã–∫–≤–∞ (–∏–ª–∏ –æ—Ä–∞–Ω–∂–µ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç)', tip:'–õ—é–±–∞—è —Ç—ã–∫–≤–∞, —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ä–∞–Ω–∂–µ–≤—ã–π –æ–±—ä–µ–∫—Ç.' },
  { id:'ghost', emoji:'üëª', name:'–ü—Ä–∏–∑—Ä–∞–∫',               tip:'–ë–µ–ª–∞—è –ø—Ä–æ—Å—Ç—ã–Ω—è, —Ä–∏—Å—É–Ω–æ–∫ –ø—Ä–∏–∑—Ä–∞–∫–∞, –∏–≥—Ä—É—à–∫–∞ –∏ —Ç. –ø.' },
  { id:'spider',emoji:'üï∑Ô∏è', name:'–ü–∞—É–∫',                 tip:'–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π, –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ ‚Äî –∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π (–µ—Å–ª–∏ —Å–º–µ–ª–æ—Å—Ç–∏ —Ö–≤–∞—Ç–∏—Ç)!' },
  { id:'potion',emoji:'üß™', name:'–ó–µ–ª—å–µ',                tip:'–ë—É—Ç—ã–ª–æ—á–∫–∞/—Å—Ç–∞–∫–∞–Ω —Å ¬´–º–∞–≥–∏—á–µ—Å–∫–∏–º¬ª —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.' }
];

/* ---------- –•–†–ê–ù–ò–õ–ö–ê ---------- */
const KEY = 'hn_hunt_photos_v1';
const state = loadState();

function loadState(){
  try{ return JSON.parse(localStorage.getItem(KEY)) || {}; }
  catch(e){ return {}; }
}
function saveState(){
  localStorage.setItem(KEY, JSON.stringify(state));
}

/* ---------- –û–¢–†–ò–°–û–í–ö–ê ---------- */
const $grid = document.getElementById('grid');
render();

function render(){
  $grid.innerHTML = '';
  TASKS.forEach(t=>{
    const s = state[t.id] || {};
    const card = document.createElement('article');
    card.className = 'card task';
    card.dataset.id = t.id;
    card.innerHTML = `
      <div class="top">
        <span class="badge ${s.photo ? 'done' : ''}">${s.photo ? '‚úì –§–æ—Ç–æ –≥–æ—Ç–æ–≤–æ' : '¬∑ ¬∑ ¬∑'}</span>
        <div class="thumb"><img id="th-${t.id}" ${s.photo?`src="${s.photo}"`:''} alt=""></div>
      </div>
      <div class="body">
        <h3><span class="em">${t.emoji}</span>${t.name}</h3>
        <p class="hint">${t.tip}</p>
        <div class="row">
          <label class="btn btn-primary">
            üì∑ –§–æ—Ç–æ/–∫–∞–º–µ—Ä–∞
            <input type="file" accept="image/*" capture="environment" data-id="${t.id}" style="display:none">
          </label>
          <button class="btn btn-ghost" data-clear="${t.id}">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    `;
    $grid.appendChild(card);
  });
  bindInputs();
}

/* ---------- –í–í–û–î/–°–û–•–†–ê–ù–ï–ù–ò–ï –§–û–¢–û ---------- */
function bindInputs(){
  // –≤—ã–±–æ—Ä —Ñ–æ—Ç–æ
  document.querySelectorAll('input[type=file][data-id]').forEach(inp=>{
    inp.addEventListener('change', async (e)=>{
      const id = e.target.dataset.id;
      const file = e.target.files && e.target.files[0];
      if(!file) return;

      const dataUrl = await fileToDataURL(file);
      state[id] = state[id] || {};
      state[id].photo = dataUrl;
      saveState();

      // –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
      const img = document.getElementById('th-'+id);
      img.src = dataUrl;
      img.closest('.task').querySelector('.badge').classList.add('done');
      e.target.value = ''; // —Å–±—Ä–æ—Å input
    });
  });

  // –æ—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ç–æ
  document.querySelectorAll('button[data-clear]').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const id = e.currentTarget.dataset.clear;
      if(state[id]?.photo){
        delete state[id].photo;
        saveState();
        const img = document.getElementById('th-'+id);
        img.removeAttribute('src');
        img.closest('.task').querySelector('.badge').classList.remove('done');
      }
    });
  });
}

function fileToDataURL(file){
  return new Promise((res,rej)=>{
    const r = new FileReader();
    r.onload = () => res(r.result);
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

/* ---------- –≠–ö–°–ü–û–†–¢ –í HTML-–ê–ª—å–±–æ–º ---------- */
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const now = new Date();
  const nice = now.toLocaleString('ru-RU').replace(/[^\d\s:.,-]/g,'');
  const items = TASKS.map(t=>{
    const photo = state[t.id]?.photo;
    return `
      <figure style="margin:0 0 24px">
        <figcaption style="font:700 16px/1.4 Montserrat,Arial">${t.emoji} ${t.name}</figcaption>
        ${photo ? `<img src="${photo}" alt="" style="margin-top:6px;max-width:100%;border-radius:10px;border:1px solid #ccc">`
                : `<div style="margin-top:6px;padding:24px;border:1px dashed #bbb;border-radius:10px;color:#666">–Ω–µ—Ç —Ñ–æ—Ç–æ</div>`}
      </figure>`;
  }).join('');

  const html = `<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–ê–ª—å–±–æ–º ‚Äî Trick-or-Treat Hunt</title></head>
  <body style="margin:0;background:#f6f7fb;font-family:Montserrat,Arial,sans-serif;color:#0f1115">
  <div style="max-width:900px;margin:24px auto;padding:0 16px">
    <div style="background:white;border-radius:16px;padding:22px 18px;border:1px solid #e6e8ef">
      <h1 style="margin:0 0 4px;font:900 28px/1.1 Montserrat">üéÉ Trick-or-Treat Hunt ‚Äî –ê–ª—å–±–æ–º</h1>
      <div style="color:#667085;margin-bottom:14px">–≠–∫—Å–ø–æ—Ä—Ç: ${nice}</div>
      ${items}
    </div>
  </div></body></html>`;

  downloadFile('hunt-album.html', new Blob([html], {type:'text/html'}));
});
function downloadFile(name, blob){
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = name;
  document.body.appendChild(a); a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
}

/* ---------- –°–ë–†–û–° ---------- */
document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –≤ —ç—Ç–æ–º –∫–≤–µ—Å—Ç–µ?')){
    localStorage.removeItem(KEY);
    for(const k in state) delete state[k];
    render();
  }
});
</script>
</body>
</html>
