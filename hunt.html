<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trick-or-Treat Photo Hunt</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<!-- JSZip –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ ZIP -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<style>
  :root{
    --bg:#0d0f14; --panel:#171a21; --muted:#9aa4b2; --text:#e9eef5; --accent:#ffb703; --ok:#37d67a;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:'Montserrat',sans-serif; color:var(--text);
    background: radial-gradient(1200px 600px at 50% -10%, #1c212b 0%, #0d0f14 55%);
  }
  .wrap{max-width:1000px;margin:28px auto;padding:0 16px}
  header{display:flex;align-items:center;gap:14px;margin-bottom:14px}
  header h1{margin:0;font-weight:900;font-size:clamp(22px,5vw,40px)}
  .lang{margin-left:auto}
  select{background:#222733;border:1px solid #2d3442;color:#fff;border-radius:10px;padding:8px 10px}
  .card{background:linear-gradient(180deg,#1a1f27 0%, #151922 100%);
        border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:20px;margin-bottom:16px}
  .hint{color:var(--muted);margin:8px 0 0}
  .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
  .task{
    border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; background:#141821;
    display:flex; flex-direction:column; gap:12px; position:relative; overflow:hidden;
  }
  .task h3{margin:0; font-size:18px}
  .task .em{font-size:24px;margin-right:6px}
  .badge{position:absolute;top:10px;right:10px;background:#222b38;color:#9fd7ff;
         border:1px solid #2f3948;border-radius:999px;padding:4px 10px;font-size:12px}
  .badge.done{background:#173222;border-color:#1e7c4e;color:#9ff4c7}
  .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
  .btn-primary{background:var(--accent);color:#17130a}
  .btn-dark{background:#242a35;color:#e9eef5;border:1px solid #2e3440}
  .btn-ghost{background:transparent;color:#a7b1c2;border:1px dashed #3a4353}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .thumb{width:100%;height:160px;background:#0f1218;border:1px solid #252b36;border-radius:12px;
        background-position:center;background-size:cover}
  .progress{display:flex;align-items:center;gap:10px;margin:10px 0 0;flex-wrap:wrap}
  .bar{height:10px;background:#202531;border:1px solid #2b3240;border-radius:999px;overflow:hidden;flex:1;min-width:180px}
  .bar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,#ffb703,#ffd166)}
  .muted{color:var(--muted)}
  .tools{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  footer{color:#6f7a89;text-align:center;margin:22px 0}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üì∏ Trick-or-Treat Photo Hunt</h1>
    <div class="lang">
      <select id="lang">
        <option value="ru">–†—É—Å</option>
        <option value="es">Esp</option>
      </select>
    </div>
  </header>

  <div class="card">
    <p id="lead" class="hint">
      –î–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ-–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ —Å—Ü–µ–Ω –∏–∑ —Å–ø–∏—Å–∫–∞. –°–æ–±–µ—Ä–∏—Ç–µ –≤—Å—ë ‚Äî –∏ –ø–æ–∫–∞–∂–∏—Ç–µ –≤–µ–¥—É—â–µ–π!
    </p>
    <div class="progress">
      <strong id="counter">0/12</strong>
      <div class="bar"><span id="bar"></span></div>
      <button id="showHost" class="btn btn-dark">–ü–æ–∫–∞–∑–∞—Ç—å –≤–µ–¥—É—â–µ–π</button>
      <button id="exportZip" class="btn btn-dark">–≠–∫—Å–ø–æ—Ä—Ç ‚Üí ZIP</button>
      <button id="exportHtml" class="btn btn-dark">–≠–∫—Å–ø–æ—Ä—Ç ‚Üí HTML-–∞–ª—å–±–æ–º</button>
      <button id="reset" class="btn btn-ghost">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
    <p class="hint" id="privacy">
      –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (–≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã). –ú–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –¥–ª—è –≤–µ–¥—É—â–µ–π.
    </p>
  </div>

  <div class="grid" id="grid"></div>

  <footer>¬© Halloween Night</footer>
</div>

<script>
const $ = s=>document.querySelector(s);
const LS_KEY='hn_photo_hunt_v1';

const DICT = {
  ru:{
    lead:"–î–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ-–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ —Å—Ü–µ–Ω –∏–∑ —Å–ø–∏—Å–∫–∞. –°–æ–±–µ—Ä–∏—Ç–µ –≤—Å—ë ‚Äî –∏ –ø–æ–∫–∞–∂–∏—Ç–µ –≤–µ–¥—É—â–µ–π!",
    showHost:"–ü–æ–∫–∞–∑–∞—Ç—å –≤–µ–¥—É—â–µ–π", reset:"–°–±—Ä–æ—Å–∏—Ç—å", done:"–ì–æ—Ç–æ–≤–æ",
    exportZip:"–≠–∫—Å–ø–æ—Ä—Ç ‚Üí ZIP", exportHtml:"–≠–∫—Å–ø–æ—Ä—Ç ‚Üí HTML-–∞–ª—å–±–æ–º",
    privacy:"–§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –î–ª—è —Å–¥–∞—á–∏ –∑–∞–¥–∞–Ω–∏—è –º–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª—å–±–æ–º.",
    tasks:[
      {id:'pumpkin', name:'–¢—ã–∫–≤–∞ (–∏–ª–∏ –æ—Ä–∞–Ω–∂–µ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç)', emoji:'üéÉ', tip:'–õ—é–±–∞—è —Ç—ã–∫–≤–∞, —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ä–∞–Ω–∂–µ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç.'},
      {id:'spider', name:'–ü–∞—É–∫/–ø–∞—É—Ç–∏–Ω–∫–∞', emoji:'üï∑', tip:'–ò–≥—Ä—É—à–∫–∞, –Ω–∞–∫–ª–µ–π–∫–∞ –∏–ª–∏ —Å–∞–º–æ–¥–µ–ª—å–Ω–∞—è –ø–∞—É—Ç–∏–Ω–∞ –∏–∑ –Ω–∏—Ç–æ–∫.'},
      {id:'potion', name:'–ó–µ–ª—å–µ –≤ —Å—Ç–∞–∫–∞–Ω–µ', emoji:'üß™', tip:'–ö—Ä–∞—Å–∏–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫/—á–∞–π, –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ ¬´–∑–µ–ª—å–µ¬ª.'},
      {id:'shadow', name:'–°—Ç—Ä–∞—à–Ω–∞—è —Ç–µ–Ω—å –Ω–∞ —Å—Ç–µ–Ω–µ', emoji:'üïØ', tip:'–°–¥–µ–ª–∞–π—Ç–µ —Ç–µ–Ω—å –æ—Ç —Ä—É–∫/–º–∞—Å–∫–∏ –Ω–∞ —Å—Ç–µ–Ω–µ.'},
      {id:'book', name:'–°—Ç–∞—Ä–∞—è –∫–Ω–∏–≥–∞', emoji:'üìñ', tip:'–õ—é–±–∞—è –∫–Ω–∏–≥–∞ ‚Äî –ª—É—á—à–µ –≤ —Ç—ë–ø–ª–æ–º —Å–≤–µ—Ç–µ.'},
      {id:'door', name:'–ó–∞–∫–æ–ª–¥–æ–≤–∞–Ω–Ω–∞—è –¥–≤–µ—Ä—å', emoji:'üö™', tip:'–°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ –ª—é–±—É—é –¥–≤–µ—Ä—å –¥—Ä–∞–º–∞—Ç–∏—á–Ω–æ.'},
      {id:'team', name:'–ö–æ–º–∞–Ω–¥–∞ —Ü–µ–ª–∏–∫–æ–º', emoji:'üßë‚Äçü§ù‚Äçüßë', tip:'–í—Å–µ –≤ –∫–∞–¥—Ä–µ, –º–æ–∂–Ω–æ —Å –≥—Ä–∏–º–∞—Å–∞–º–∏.'},
      {id:'witch', name:'–ö–æ–ª–¥–æ–≤—Å–∫–æ–π –∫–∞–¥—Ä', emoji:'üßô‚Äç‚ôÄÔ∏è', tip:'–ö—Ç–æ-—Ç–æ —Å ¬´–º–µ—Ç–ª–æ–π¬ª, —à–ª—è–ø–æ–π –∏–ª–∏ –ø–æ–∑–æ–π –≤–µ–¥—å–º—ã.'},
      {id:'ghost', name:'–ü—Ä–∏–∑—Ä–∞–∫', emoji:'üëª', tip:'–ü–ª–µ–¥/–ø—Ä–æ—Å—Ç—ã–Ω—è –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ ¬´–ø—Ä–∏–∑—Ä–∞—á–Ω–∞—è¬ª –ø–æ–∑–∞.'},
      {id:'laugh', name:'–•–æ—Ö–æ—Ç –≤–µ–¥—å–º—ã', emoji:'üòà', tip:'–ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω —Å–º–µ—à–Ω–æ–π/–∑–ª–æ–≤–µ—â–µ–π —É–ª—ã–±–∫–∏.'},
      {id:'eyes', name:'–ì–ª–∞–∑–∞ –≤ —Ç–µ–º–Ω–æ—Ç–µ', emoji:'üëÄ', tip:'–î–≤–µ ¬´—Ç–æ—á–∫–∏¬ª —Å–≤–µ—Ç–∞ –∏–ª–∏ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–µ –≥–ª–∞–∑–∞.'},
      {id:'treat', name:'–°–ª–∞–¥–æ—Å—Ç—å –∏–ª–∏ –≥–∞–¥–æ—Å—Ç—å', emoji:'üç¨', tip:'–§–æ—Ç–æ –ª—é–±–∏–º–æ–π –∫–æ–Ω—Ñ–µ—Ç—ã –∏–ª–∏ –∏–º–ø—Ä–æ–≤–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ ¬´–∑–µ–ª—å—è¬ª.'},
    ]
  },
  es:{
    lead:"Haz fotos-prueba de los objetos y escenas de la lista. ¬°Re√∫ne todo y ens√©√±alo a la anfitriona!",
    showHost:"Mostrar a la anfitriona", reset:"Reiniciar", done:"Hecho",
    exportZip:"Exportar ‚Üí ZIP", exportHtml:"Exportar ‚Üí √Ålbum HTML",
    privacy:"Las fotos se guardan localmente en tu dispositivo. Puedes exportarlas como √°lbum para entregarlas.",
    tasks:[
      {id:'pumpkin', name:'Calabaza (o algo naranja)', emoji:'üéÉ', tip:'Cualquier calabaza u objeto naranja.'},
      {id:'spider', name:'Ara√±a/telara√±a', emoji:'üï∑', tip:'Juguete, pegatina o telara√±a casera.'},
      {id:'potion', name:'Poci√≥n en un vaso', emoji:'üß™', tip:'Bebida/t√© que parezca poci√≥n.'},
      {id:'shadow', name:'Sombra tenebrosa en la pared', emoji:'üïØ', tip:'Sombras de manos o m√°scara.'},
      {id:'book', name:'Libro antiguo', emoji:'üìñ', tip:'Cualquier libro con luz c√°lida.'},
      {id:'door', name:'Puerta encantada', emoji:'üö™', tip:'Cualquier puerta con pose dram√°tica.'},
      {id:'team', name:'Equipo completo', emoji:'üßë‚Äçü§ù‚Äçüßë', tip:'Todos en el encuadre.'},
      {id:'witch', name:'Toma de bruja', emoji:'üßô‚Äç‚ôÄÔ∏è', tip:'Sombrero/escoba o pose de bruja.'},
      {id:'ghost', name:'Fantasma', emoji:'üëª', tip:'S√°bana o pose fantasmal.'},
      {id:'laugh', name:'Risa malvada', emoji:'üòà', tip:'Primer plano de risa/sonrisa.'},
      {id:'eyes', name:'Ojos en la oscuridad', emoji:'üëÄ', tip:'Dos puntos de luz o ojos dibujados.'},
      {id:'treat', name:'Truco o trato', emoji:'üç¨', tip:'Dulce favorito o ‚Äúpoci√≥n‚Äù.'},
    ]
  }
};

let lang = localStorage.getItem('hn_lang') || 'ru';
$('#lang').value = lang;
$('#lang').addEventListener('change', e=>{
  lang = e.target.value; localStorage.setItem('hn_lang', lang); paint();
});

function load(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)) || {}; }catch{ return {}; } }
function save(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }
let state = load(); // {id: {photo: dataURL}}

function paint(){
  const d = DICT[lang];
  $('#lead').textContent = d.lead;
  $('#showHost').textContent = d.showHost;
  $('#reset').textContent = d.reset;
  $('#exportZip').textContent = d.exportZip;
  $('#exportHtml').textContent = d.exportHtml;
  $('#privacy').textContent = d.privacy;

  const grid = $('#grid'); grid.innerHTML='';
  d.tasks.forEach(t=>{
    const s = state[t.id] || {};
    const card = document.createElement('div');
    card.className = 'task';
    card.innerHTML = `
      <span class="badge ${s.photo?'done':''}">${s.photo ? '‚úì '+d.done : '¬∑ ¬∑ ¬∑'}</span>
      <div class="thumb" id="th-${t.id}" ${s.photo?`style="background-image:url('${s.photo}')"`:''}></div>
      <h3><span class="em">${t.emoji}</span>${t.name}</h3>
      <p class="hint">${t.tip}</p>
      <div class="row">
        <label class="btn btn-primary">
          üì∑ –§–æ—Ç–æ/–∫–∞–º–µ—Ä–∞
          <input type="file" accept="image/*" capture="environment" data-id="${t.id}" style="display:none">
        </label>
        <button class="btn btn-ghost" data-clear="${t.id}">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
    `;
    grid.appendChild(card);
  });
  bindInputs();
  updateProgress();
}

function bindInputs(){
  document.querySelectorAll('input[type=file]').forEach(inp=>{
    inp.addEventListener('change', async (e)=>{
      const id = e.target.dataset.id;
      const file = e.target.files[0];
      if(!file) return;
      const dataUrl = await fileToDataURL(file);
      state[id] = {photo:dataUrl};
      save(state);
      const th = document.getElementById('th-'+id);
      th.style.backgroundImage = `url('${dataUrl}')`;
      th.previousElementSibling?.classList?.add('done'); // badge
      updateProgress();
    });
  });
  document.querySelectorAll('[data-clear]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-clear');
      delete state[id];
      save(state);
      paint();
    });
  });
}

function fileToDataURL(file){
  return new Promise(res=>{
    const r = new FileReader();
    r.onload = ()=>res(r.result);
    r.readAsDataURL(file);
  });
}

function updateProgress(){
  const total = DICT[lang].tasks.length;
  const done = Object.keys(state).length;
  document.getElementById('counter').textContent = `${done}/${total}`;
  document.getElementById('bar').style.width = `${Math.round(done/total*100)}%`;
}

document.getElementById('reset').addEventListener('click', ()=>{
  if(confirm(lang==='ru'?'–°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å?':'¬øReiniciar fotos y progreso?')){
    state = {}; save(state); paint();
  }
});

document.getElementById('showHost').addEventListener('click', ()=>{
  alert(lang==='ru'
    ? '–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –º–∏–Ω–∏–∞—Ç—é—Ä–∞–º–∏ ‚Äî –≤–µ–¥—É—â–∞—è –ø—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.'
    : 'Desplaza las tarjetas con miniaturas: la anfitriona comprobar√° que todo est√© hecho.');
});

document.getElementById('exportZip').addEventListener('click', async ()=>{
  const zip = new JSZip();
  const folder = zip.folder('photo-hunt') ;
  let idx=1;
  for(const t of DICT[lang].tasks){
    const s = state[t.id];
    if(s && s.photo){
      const data = s.photo.split(',')[1];
      folder.file(`${idx.toString().padStart(2,'0')}_${t.id}.png`, data, {base64:true});
      idx++;
    }
  }
  const blob = await zip.generateAsync({type:'blob'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'photo-hunt.zip';
  a.click();
  URL.revokeObjectURL(a.href);
});

document.getElementById('exportHtml').addEventListener('click', ()=>{
  const d = DICT[lang];
  let html = `<!DOCTYPE html><meta charset="utf-8"><title>Photo Hunt Album</title>
  <style>body{font-family:Montserrat,Arial,sans-serif;background:#111;color:#eee;margin:20px}
  .item{margin:0 0 18px}.item h3{margin:6px 0 8px}
  img{max-width:100%;border-radius:12px;border:1px solid #333}</style>
  <h1>Photo Hunt ‚Äî ${new Date().toLocaleString()}</h1>`;
  d.tasks.forEach(t=>{
    const s = state[t.id];
    if(s && s.photo){
      html += `<div class="item"><h3>${t.emoji} ${t.name}</h3><img src="${s.photo}"></div>`;
    }
  });
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'photo-hunt-album.html'; a.click();
  URL.revokeObjectURL(url);
});

paint();
</script>
</body>
</html>
