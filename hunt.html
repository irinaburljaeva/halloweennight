<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trick-or-Treat Hunt</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0d0f14; --panel:#171a21; --muted:#9aa4b2; --text:#e9eef5; --accent:#ffb703; --ok:#37d67a; --warn:#f25f5c;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:'Montserrat',sans-serif; color:var(--text);
    background: radial-gradient(1200px 600px at 50% -10%, #1c212b 0%, #0d0f14 55%);
  }
  .wrap{max-width:960px;margin:28px auto;padding:0 16px}
  header{display:flex;align-items:center;gap:14px;margin-bottom:14px}
  header h1{margin:0;font-weight:900;font-size:clamp(22px,5vw,40px)}
  .lang{margin-left:auto}
  select{background:#222733;border:1px solid #2d3442;color:#fff;border-radius:10px;padding:8px 10px}
  .card{background:linear-gradient(180deg,#1a1f27 0%, #151922 100%);
        border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:20px;margin-bottom:16px}
  .hint{color:var(--muted);margin:8px 0 0}
  .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
  .trophy{
    border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; background:#141821;
    display:flex; flex-direction:column; gap:10px; position:relative; overflow:hidden;
  }
  .trophy h3{margin:0; font-size:18px}
  .trophy .em{font-size:26px;margin-right:6px}
  .badge{position:absolute;top:10px;right:10px;background:#222b38;color:#9fd7ff;
         border:1px solid #2f3948;border-radius:999px;padding:4px 10px;font-size:12px}
  .badge.done{background:#173222;border-color:#1e7c4e;color:#9ff4c7}
  .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
  .btn-primary{background:var(--accent);color:#17130a}
  .btn-dark{background:#242a35;color:#e9eef5;border:1px solid #2e3440}
  .btn-ghost{background:transparent;color:#a7b1c2;border:1px dashed #3a4353}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .thumb{width:100%;height:140px;background:#0f1218;border:1px solid #252b36;border-radius:12px;
        background-position:center;background-size:cover}
  .progress{display:flex;align-items:center;gap:10px;margin:10px 0 0}
  .bar{height:10px;background:#202531;border:1px solid #2b3240;border-radius:999px;overflow:hidden;flex:1}
  .bar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,#ffb703,#ffd166)}
  .ok{color:var(--ok);font-weight:800}
  .muted{color:var(--muted)}
  .tools{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  .tools a{color:#8fb3ff;text-decoration:none}
  footer{color:#6f7a89;text-align:center;margin:22px 0}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üéÉ Trick-or-Treat Hunt</h1>
    <div class="lang">
      <select id="lang">
        <option value="ru">–†—É—Å</option>
        <option value="es">Esp</option>
      </select>
    </div>
  </header>

  <div class="card">
    <p id="lead" class="hint">
      –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–º–µ—Ç–∫–∏ –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ-–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–∞—Ö–æ–¥–æ–∫. –°–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ —Ç—Ä–æ—Ñ–µ–∏!
    </p>
    <div class="progress">
      <strong id="counter">0/6</strong>
      <div class="bar"><span id="bar"></span></div>
      <button id="showHost" class="btn btn-dark">–ü–æ–∫–∞–∑–∞—Ç—å –≤–µ–¥—É—â–µ–π</button>
      <button id="reset" class="btn btn-ghost">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>
    <div class="tools hint" id="qrTips">
      –ë—ã—Å—Ç—Ä—ã–µ QR-—Å—Å—ã–ª–∫–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏: 
      <a href="hunt.html?unlock=bat">bat</a> ¬∑
      <a href="hunt.html?unlock=witch">witch</a> ¬∑
      <a href="hunt.html?unlock=pumpkin">pumpkin</a> ¬∑
      <a href="hunt.html?unlock=ghost">ghost</a> ¬∑
      <a href="hunt.html?unlock=spider">spider</a> ¬∑
      <a href="hunt.html?unlock=potion">potion</a>
    </div>
  </div>

  <div class="grid" id="grid"></div>

  <footer>¬© Halloween Night</footer>
</div>

<script>
const $ = s=>document.querySelector(s);
const LS_KEY='hh_trophies_v1';

const DICT = {
  ru:{
    lead:"–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–º–µ—Ç–∫–∏ –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ-–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–∞—Ö–æ–¥–æ–∫. –°–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ —Ç—Ä–æ—Ñ–µ–∏!",
    showHost:"–ü–æ–∫–∞–∑–∞—Ç—å –≤–µ–¥—É—â–µ–π", reset:"–°–±—Ä–æ—Å–∏—Ç—å", done:"–ù–∞–π–¥–µ–Ω–æ", hint:"–ü–æ–¥—Å–∫–∞–∑–∫–∞",
    t:[
      {id:'bat',    name:'–õ–µ—Ç—É—á–∞—è –º—ã—à—å',  hint:'–ü–æ—Å–º–æ—Ç—Ä–∏ —Ç—É–¥–∞, –≥–¥–µ —Ç–µ–º–Ω–µ–µ –≤—Å–µ–≥–æ ‚Äî –ø–æ–¥ –∞–±–∞–∂—É—Ä–æ–º, –∑–∞–Ω–∞–≤–µ—Å–∫–æ–π –∏–ª–∏ –Ω–∞ –ø–æ—Ä–æ–≥–µ –æ–∫–Ω–∞.', emoji:'ü¶á'},
      {id:'witch',  name:'–í–µ–¥—å–º–∞',        hint:'–ò—â–∏ —Å–ª–µ–¥—ã —à–ª—è–ø—ã, –º–µ—Ç–ª—ã –∏–ª–∏ –∫–æ—Ç–ª–∞ –Ω–∞ –∫—É—Ö–Ω–µ.', emoji:'üßô‚Äç‚ôÄÔ∏è'},
      {id:'pumpkin',name:'–¢—ã–∫–≤–∞',         hint:'–¢–∞–º, –≥–¥–µ —Å–≤–µ—Ç —Ç–µ–ø–ª–µ–µ: –≤–æ–∑–ª–µ —Å–≤–µ—á–∏, –≥–∏—Ä–ª—è–Ω–¥—ã –∏–ª–∏ —á–∞–π–Ω–∏–∫–∞.', emoji:'üéÉ'},
      {id:'ghost',  name:'–ü—Ä–∏–∑—Ä–∞–∫',       hint:'–ú–æ–∂–µ—Ç –ø—Ä—è—Ç–∞—Ç—å—Å—è –≤ –∑–µ—Ä–∫–∞–ª–µ –∏–ª–∏ –∑–∞ –¥–≤–µ—Ä—å—é —à–∫–∞—Ñ–∞.', emoji:'üëª'},
      {id:'spider', name:'–ü–∞—É–∫',          hint:'–í—ã—Å–æ–∫–æ-–≤—ã—Å–æ–∫–æ‚Ä¶ –Ω–∞ –∫–∞—Ä–Ω–∏–∑–µ, –≤ —É–≥–ª—É –ø–æ—Ç–æ–ª–∫–∞ –∏–ª–∏ —É —Ä–∞–º–æ–∫.', emoji:'üï∑'},
      {id:'potion', name:'–ó–µ–ª—å–µ',         hint:'–û–≥–ª—è–Ω–∏—Å—å –Ω–∞ –∫—É—Ö–Ω—é: –ø—É–∑—ã—Ä—ë–∫, –±–∞–Ω–∫–∞ —Å —ç—Ç–∏–∫–µ—Ç–∫–æ–π, —á–∞–π —Å –∫–æ—Ä–∏—Ü–µ–π.', emoji:'üß™'}
    ]
  },
  es:{
    lead:"Escanea los c√≥digos QR o haz una foto-prueba de lo que encuentres. ¬°Re√∫ne todos los trofeos!",
    showHost:"Mostrar a la anfitriona", reset:"Reiniciar", done:"Encontrado", hint:"Pista",
    t:[
      {id:'bat',    name:'Murci√©lago',   hint:'Busca donde est√° m√°s oscuro: bajo una l√°mpara o detr√°s de la cortina.', emoji:'ü¶á'},
      {id:'witch',  name:'Bruja',        hint:'Sombrero, escoba o caldero‚Ä¶ quiz√° en la cocina.', emoji:'üßô‚Äç‚ôÄÔ∏è'},
      {id:'pumpkin',name:'Calabaza',     hint:'Donde haya luz c√°lida: cerca de velas o guirnaldas.', emoji:'üéÉ'},
      {id:'ghost',  name:'Fantasma',     hint:'Puede ocultarse en el espejo o detr√°s del armario.', emoji:'üëª'},
      {id:'spider', name:'Ara√±a',        hint:'Muy arriba: en la cornisa o en una esquina.', emoji:'üï∑'},
      {id:'potion', name:'Poci√≥n',       hint:'En la cocina: frasco con etiqueta, t√© con canela.', emoji:'üß™'}
    ]
  }
};

let lang = localStorage.getItem('hh_lang') || 'ru';
$('#lang').value = lang;
$('#lang').addEventListener('change', e=>{
  lang = e.target.value;
  localStorage.setItem('hh_lang', lang);
  paint();
});

function loadState(){
  try{ return JSON.parse(localStorage.getItem(LS_KEY)) || {}; }catch{ return {}; }
}
function saveState(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }
let state = loadState(); // {bat:{found:true, photo:'data:'}, ...}

function unlockByQuery(){
  const u = new URL(location.href);
  const id = (u.searchParams.get('unlock')||'').toLowerCase();
  if(!id) return;
  state[id] = state[id] || {};
  state[id].found = true;
  saveState(state);
  // –æ—á–∏—Å—Ç–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–æ
  u.searchParams.delete('unlock');
  history.replaceState({},'',u.toString());
}
unlockByQuery();

function paint(){
  const dict = DICT[lang];
  $('#lead').textContent = dict.lead;
  $('#showHost').textContent = dict.showHost;
  $('#reset').textContent = dict.reset;

  const grid = $('#grid'); grid.innerHTML='';
  dict.t.forEach(item=>{
    const s = state[item.id] || {};
    const card = document.createElement('div');
    card.className = 'trophy';
    card.innerHTML = `
      <span class="badge ${s.found?'done':''}">${s.found ? '‚úì '+dict.done : '¬∑ ¬∑ ¬∑'}</span>
      <div class="thumb" id="thumb-${item.id}" ${s.photo ? `style="background-image:url('${s.photo}')"`:''}></div>
      <h3><span class="em">${item.emoji}</span>${item.name}</h3>
      <p class="hint"><b>${dict.hint}:</b> ${item.hint}</p>
      <div class="row">
        <a class="btn btn-dark" href="hunt.html?unlock=${item.id}">üîì QR/–∫–æ–¥</a>
        <label class="btn btn-primary">
          üì∑ –§–æ—Ç–æ/–∫–∞–º–µ—Ä–∞
          <input type="file" accept="image/*" capture="environment" data-id="${item.id}" style="display:none">
        </label>
        <button class="btn btn-ghost" data-clear="${item.id}">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
    `;
    grid.appendChild(card);
  });
  bindInputs();
  updateProgress();
}

function bindInputs(){
  document.querySelectorAll('input[type=file]').forEach(inp=>{
    inp.addEventListener('change', async (e)=>{
      const id = e.target.dataset.id;
      const file = e.target.files[0];
      if(!file) return;
      const dataUrl = await fileToDataURL(file);
      state[id] = state[id] || {};
      state[id].photo = dataUrl;
      state[id].found = true;
      saveState(state);
      const th = $('#thumb-'+id);
      th.style.backgroundImage = `url('${dataUrl}')`;
      th.classList.add('has');
      updateProgress();
    });
  });
  document.querySelectorAll('[data-clear]').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const id = btn.getAttribute('data-clear');
      if(state[id]){
        delete state[id].photo;
        delete state[id].found;
      }
      saveState(state);
      paint();
    });
  });
}

function fileToDataURL(file){
  return new Promise(res=>{
    const r = new FileReader();
    r.onload = ()=>res(r.result);
    r.readAsDataURL(file);
  });
}

function updateProgress(){
  const total = DICT[lang].t.length;
  const done = Object.values(state).filter(x=>x && x.found).length;
  $('#counter').textContent = `${done}/${total}`;
  $('#bar').style.width = `${Math.round(done/total*100)}%`;
}

$('#reset').addEventListener('click', ()=>{
  if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Ö–æ—Ç—ã?')){ localStorage.removeItem(LS_KEY); state={}; paint(); }
});
$('#showHost').addEventListener('click', ()=>{
  alert(lang==='ru'
    ? '–ü–æ–∫–∞–∂–∏—Ç–µ –º–∏–Ω–∏–∞—Ç—é—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∏ —Å—á—ë—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö (–≤–≤–µ—Ä—Ö—É). –í–µ–¥—É—â–∞—è –≤—ã–¥–∞—ë—Ç –ø—Ä–∏–∑!'
    : 'Muestra las miniaturas en las tarjetas y el contador de hallazgos. ¬°Premio del anfitri√≥n!');
});

paint();
</script>
</body>
</html>
